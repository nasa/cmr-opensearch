<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Cmr-opensearch-mimemagic</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.12.3/application.js' type='text/javascript'></script>
    <link href='./assets/0.12.3/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="shortcut icon" type="image/png" href="./assets/0.12.3/favicon_yellow.png" />
    <link rel="icon" type="image/png" href="./assets/0.12.3/favicon.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.12.3/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2021-03-29T15:16:29-04:00">2021-03-29T15:16:29-04:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="yellow">
  88.74%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         799.37
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>23</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1466</b> relevant lines,
    <span class="green"><b>1301</b> lines covered</span> and
    <span class="red"><b>165</b> lines missed. </span>
    (<span class="yellow">
  88.74%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#39fd26d2d66de71a4ef46bf3654983138a5a796e" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.59 %</td>
            <td class="cell--number">83</td>
            <td class="cell--number">54</td>
            <td class="cell--number">50</td>
            <td class="cell--number">4</td>
            <td class="cell--number">294.15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d227cc5c24f0ea2c358bb28791b1e52184c6c0aa" class="src_link" title="app/controllers/collections_controller.rb">app/controllers/collections_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">76</td>
            <td class="cell--number">76</td>
            <td class="cell--number">0</td>
            <td class="cell--number">94.54</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#89f947c7f292eecc633520311d0321748187673b" class="src_link" title="app/controllers/granules_controller.rb">app/controllers/granules_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.30 %</td>
            <td class="cell--number">151</td>
            <td class="cell--number">81</td>
            <td class="cell--number">78</td>
            <td class="cell--number">3</td>
            <td class="cell--number">53.89</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d22f63fc13a829b854d7ba477343b1d81a8c2bb4" class="src_link" title="app/controllers/health_controller.rb">app/controllers/health_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.63</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#744b752e3ec4f9c8b23a1704d4e60f4928a04c5c" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1.60</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e986225286cbf2378c7bd93408d13625563266b5" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.73 %</td>
            <td class="cell--number">112</td>
            <td class="cell--number">79</td>
            <td class="cell--number">78</td>
            <td class="cell--number">1</td>
            <td class="cell--number">190.05</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#893f6da6526767538085b0e1fc94dc7c5a6ad8be" class="src_link" title="app/helpers/collections_helper.rb">app/helpers/collections_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">40.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#89ee02f55671eabed2f0770f88876be559e52091" class="src_link" title="app/helpers/granules_helper.rb">app/helpers/granules_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">15.00 %</td>
            <td class="cell--number">32</td>
            <td class="cell--number">20</td>
            <td class="cell--number">3</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#aec615579c20a27698a88bafcf536409d48a87a5" class="src_link" title="app/helpers/home_helper.rb">app/helpers/home_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8ca87cb08695718d87b513350ea9a5608ef71936" class="src_link" title="app/jobs/job_base.rb">app/jobs/job_base.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5d0dcffe7bbf5fa1a200318594a4506099cd2a83" class="src_link" title="app/jobs/memory_profiler.rb">app/jobs/memory_profiler.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#471129b7d1ad8996aed27d3856812716d5361e70" class="src_link" title="app/models/ceos_agency.rb">app/models/ceos_agency.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.77 %</td>
            <td class="cell--number">78</td>
            <td class="cell--number">31</td>
            <td class="cell--number">30</td>
            <td class="cell--number">1</td>
            <td class="cell--number">9.19</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fcc39ede66aa59ee82398d5f541177a6afb8a9a2" class="src_link" title="app/models/client_id.rb">app/models/client_id.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.91 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">11</td>
            <td class="cell--number">10</td>
            <td class="cell--number">1</td>
            <td class="cell--number">24.18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f79a3d590749fda47083c07038caf33fffb29a25" class="src_link" title="app/models/collection.rb">app/models/collection.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.62 %</td>
            <td class="cell--number">380</td>
            <td class="cell--number">251</td>
            <td class="cell--number">240</td>
            <td class="cell--number">11</td>
            <td class="cell--number">3199.41</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#679c26bbf019d43978941e2d8e97f9f8e024f80b" class="src_link" title="app/models/facet.rb">app/models/facet.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.88 %</td>
            <td class="cell--number">149</td>
            <td class="cell--number">64</td>
            <td class="cell--number">62</td>
            <td class="cell--number">2</td>
            <td class="cell--number">475.41</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a6b2b9901d99d2c7271170fbbb0504d2b227975c" class="src_link" title="app/models/granule.rb">app/models/granule.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.31 %</td>
            <td class="cell--number">190</td>
            <td class="cell--number">123</td>
            <td class="cell--number">116</td>
            <td class="cell--number">7</td>
            <td class="cell--number">471.76</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8edf4db1cce12de14925b007de364853cdc8cfd7" class="src_link" title="app/models/health.rb">app/models/health.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.36</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4d4e0816194b7247da0f1046bbec2aa1b919a750" class="src_link" title="app/models/metadata.rb">app/models/metadata.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.39 %</td>
            <td class="cell--number">719</td>
            <td class="cell--number">460</td>
            <td class="cell--number">402</td>
            <td class="cell--number">58</td>
            <td class="cell--number">512.80</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2243f432da5b0f6d45c9593aec23957762ab70cb" class="src_link" title="app/models/token.rb">app/models/token.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#baa50acb1e1b70ab20213e687457df3140265ec2" class="src_link" title="app/services/connection_verifier.rb">app/services/connection_verifier.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2f3522218aa2242a6f05e60574ac63ff72f0a04a" class="src_link" title="app/services/eosdis_tagger.rb">app/services/eosdis_tagger.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.72 %</td>
            <td class="cell--number">177</td>
            <td class="cell--number">97</td>
            <td class="cell--number">88</td>
            <td class="cell--number">9</td>
            <td class="cell--number">7.69</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cb8a13b46016e1e68d99562d31c9bc64bbdf1091" class="src_link" title="app/services/place_name_to_point.rb">app/services/place_name_to_point.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.78</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2c445d8e7fefeee2cf6a88395a03bce297fd0176" class="src_link" title="app/services/well_formed_text.rb">app/services/well_formed_text.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">16.50</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="green">
  96.43%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         122.57
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>224</b> relevant lines,
    <span class="green"><b>216</b> lines covered</span> and
    <span class="red"><b>8</b> lines missed. </span>
    (<span class="green">
  96.43%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#39fd26d2d66de71a4ef46bf3654983138a5a796e" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.59 %</td>
            <td class="cell--number">83</td>
            <td class="cell--number">54</td>
            <td class="cell--number">50</td>
            <td class="cell--number">4</td>
            <td class="cell--number">294.15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d227cc5c24f0ea2c358bb28791b1e52184c6c0aa" class="src_link" title="app/controllers/collections_controller.rb">app/controllers/collections_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">76</td>
            <td class="cell--number">76</td>
            <td class="cell--number">0</td>
            <td class="cell--number">94.54</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#89f947c7f292eecc633520311d0321748187673b" class="src_link" title="app/controllers/granules_controller.rb">app/controllers/granules_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.30 %</td>
            <td class="cell--number">151</td>
            <td class="cell--number">81</td>
            <td class="cell--number">78</td>
            <td class="cell--number">3</td>
            <td class="cell--number">53.89</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d22f63fc13a829b854d7ba477343b1d81a8c2bb4" class="src_link" title="app/controllers/health_controller.rb">app/controllers/health_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.63</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#744b752e3ec4f9c8b23a1704d4e60f4928a04c5c" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1.60</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="yellow">
  89.83%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1159.29
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>8</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>973</b> relevant lines,
    <span class="green"><b>874</b> lines covered</span> and
    <span class="red"><b>99</b> lines missed. </span>
    (<span class="yellow">
  89.83%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#471129b7d1ad8996aed27d3856812716d5361e70" class="src_link" title="app/models/ceos_agency.rb">app/models/ceos_agency.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.77 %</td>
            <td class="cell--number">78</td>
            <td class="cell--number">31</td>
            <td class="cell--number">30</td>
            <td class="cell--number">1</td>
            <td class="cell--number">9.19</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fcc39ede66aa59ee82398d5f541177a6afb8a9a2" class="src_link" title="app/models/client_id.rb">app/models/client_id.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.91 %</td>
            <td class="cell--number">19</td>
            <td class="cell--number">11</td>
            <td class="cell--number">10</td>
            <td class="cell--number">1</td>
            <td class="cell--number">24.18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f79a3d590749fda47083c07038caf33fffb29a25" class="src_link" title="app/models/collection.rb">app/models/collection.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.62 %</td>
            <td class="cell--number">380</td>
            <td class="cell--number">251</td>
            <td class="cell--number">240</td>
            <td class="cell--number">11</td>
            <td class="cell--number">3199.41</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#679c26bbf019d43978941e2d8e97f9f8e024f80b" class="src_link" title="app/models/facet.rb">app/models/facet.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.88 %</td>
            <td class="cell--number">149</td>
            <td class="cell--number">64</td>
            <td class="cell--number">62</td>
            <td class="cell--number">2</td>
            <td class="cell--number">475.41</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a6b2b9901d99d2c7271170fbbb0504d2b227975c" class="src_link" title="app/models/granule.rb">app/models/granule.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.31 %</td>
            <td class="cell--number">190</td>
            <td class="cell--number">123</td>
            <td class="cell--number">116</td>
            <td class="cell--number">7</td>
            <td class="cell--number">471.76</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8edf4db1cce12de14925b007de364853cdc8cfd7" class="src_link" title="app/models/health.rb">app/models/health.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.36</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4d4e0816194b7247da0f1046bbec2aa1b919a750" class="src_link" title="app/models/metadata.rb">app/models/metadata.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.39 %</td>
            <td class="cell--number">719</td>
            <td class="cell--number">460</td>
            <td class="cell--number">402</td>
            <td class="cell--number">58</td>
            <td class="cell--number">512.80</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2243f432da5b0f6d45c9593aec23957762ab70cb" class="src_link" title="app/models/token.rb">app/models/token.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="yellow">
  82.86%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         144.93
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>105</b> relevant lines,
    <span class="green"><b>87</b> lines covered</span> and
    <span class="red"><b>18</b> lines missed. </span>
    (<span class="yellow">
  82.86%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e986225286cbf2378c7bd93408d13625563266b5" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.73 %</td>
            <td class="cell--number">112</td>
            <td class="cell--number">79</td>
            <td class="cell--number">78</td>
            <td class="cell--number">1</td>
            <td class="cell--number">190.05</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#893f6da6526767538085b0e1fc94dc7c5a6ad8be" class="src_link" title="app/helpers/collections_helper.rb">app/helpers/collections_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">40.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#89ee02f55671eabed2f0770f88876be559e52091" class="src_link" title="app/helpers/granules_helper.rb">app/helpers/granules_helper.rb</a></td>
            <td class="red strong cell--number t-file__coverage">15.00 %</td>
            <td class="cell--number">32</td>
            <td class="cell--number">20</td>
            <td class="cell--number">3</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#aec615579c20a27698a88bafcf536409d48a87a5" class="src_link" title="app/helpers/home_helper.rb">app/helpers/home_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>19</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>19</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8ca87cb08695718d87b513350ea9a5608ef71936" class="src_link" title="app/jobs/job_base.rb">app/jobs/job_base.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5d0dcffe7bbf5fa1a200318594a4506099cd2a83" class="src_link" title="app/jobs/memory_profiler.rb">app/jobs/memory_profiler.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="yellow">
  85.52%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         8.41
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>145</b> relevant lines,
    <span class="green"><b>124</b> lines covered</span> and
    <span class="red"><b>21</b> lines missed. </span>
    (<span class="yellow">
  85.52%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#baa50acb1e1b70ab20213e687457df3140265ec2" class="src_link" title="app/services/connection_verifier.rb">app/services/connection_verifier.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2f3522218aa2242a6f05e60574ac63ff72f0a04a" class="src_link" title="app/services/eosdis_tagger.rb">app/services/eosdis_tagger.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.72 %</td>
            <td class="cell--number">177</td>
            <td class="cell--number">97</td>
            <td class="cell--number">88</td>
            <td class="cell--number">9</td>
            <td class="cell--number">7.69</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cb8a13b46016e1e68d99562d31c9bc64bbdf1091" class="src_link" title="app/services/place_name_to_point.rb">app/services/place_name_to_point.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.78</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2c445d8e7fefeee2cf6a88395a03bce297fd0176" class="src_link" title="app/services/well_formed_text.rb">app/services/well_formed_text.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">16.50</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.21.2
        and simplecov-html v0.12.3<br/>
        using Cucumber Features, RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="39fd26d2d66de71a4ef46bf3654983138a5a796e">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="green">
  92.59%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>54</b> relevant lines.
      <span class="green"><b>50</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="2">
            <span class="hits">2</span>
            

            

            <code class="ruby">  protect_from_forgery</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def log_performance(method, time, number_of_records = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="5">
            <span class="hits">331</span>
            

            

            <code class="ruby">    log = &quot;#{method} request with parameters #{params_to_logging(params)} took #{(time.to_f * 1000).round(0)} ms&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="6">
            <span class="hits">331</span>
            

            

            <code class="ruby">    unless number_of_records.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="7">
            <span class="hits">331</span>
            

            

            <code class="ruby">      log.concat(&quot; and returned #{number_of_records} hit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="8">
            <span class="hits">331</span>
            

            

            <code class="ruby">      log.concat(&#39;s&#39;) if number_of_records == 0 || number_of_records &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="10">
            <span class="hits">331</span>
            

            

            <code class="ruby">    log</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="13">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def params_to_logging(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="14">
            <span class="hits">331</span>
            

            

            <code class="ruby">    params.delete(&#39;controller&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="15">
            <span class="hits">331</span>
            

            

            <code class="ruby">    params.delete(&#39;action&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="16">
            <span class="hits">331</span>
            

            

            <code class="ruby">    params.delete(&#39;commit&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="17">
            <span class="hits">331</span>
            

            

            <code class="ruby">    params.delete(&#39;utf8&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3175" data-linenumber="18">
            <span class="hits">3175</span>
            

            

            <code class="ruby">    params.delete_if {|key, value| value.nil? || (value.kind_of?(String) &amp;&amp; value.empty?) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="19">
            <span class="hits">331</span>
            

            

            <code class="ruby">    params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def destroy_token</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">    Rails.logger.info &quot;Destroying Token ID: #{@token_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">      Token.delete(@token_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">    rescue</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            <span class="hits">2</span>
            

            

            <code class="ruby">  protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def extract_common_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="34">
            <span class="hits">347</span>
            

            

            <code class="ruby">    @client_id = params[:clientId]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">    # If format is html remove spatial constraints that do not match spatial type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="37">
            <span class="hits">347</span>
            

            

            <code class="ruby">    if request.format == :html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="39">
            <span class="hits">171</span>
            

            

            <code class="ruby">      @spatial_type = params[:spatial_type] || &#39;bbox&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="41">
            <span class="hits">171</span>
            

            

            <code class="ruby">      params[:boundingBox] = nil unless @spatial_type == &#39;bbox&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="42">
            <span class="hits">171</span>
            

            

            <code class="ruby">      params[:geometry] = nil unless @spatial_type == &#39;geometry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="43">
            <span class="hits">171</span>
            

            

            <code class="ruby">      params[:placeName] = nil unless @spatial_type == &#39;placename&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="46">
            <span class="hits">347</span>
            

            

            <code class="ruby">    @number_of_results = params[:numberOfResults].blank? ? 10 : params[:numberOfResults]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="47">
            <span class="hits">347</span>
            

            

            <code class="ruby">    params[:numberOfResults] = @number_of_results</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="48">
            <span class="hits">347</span>
            

            

            <code class="ruby">    @cursor = params[:cursor].blank? ? 1 : params[:cursor]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">    # do not default offset, the impact to existing code is not worth it</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">    # per CEOS-BP-007, if both offset and cursor are present, offset (startIndex) preceeds cursor (startPage)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="51">
            <span class="hits">347</span>
            

            

            <code class="ruby">    @offset = params[:offset]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="52">
            <span class="hits">347</span>
            

            

            <code class="ruby">    if !params[:offset].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="53">
            <span class="hits">24</span>
            

            

            <code class="ruby">      params[:cursor] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="54">
            <span class="hits">24</span>
            

            

            <code class="ruby">      @cursor = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="56">
            <span class="hits">347</span>
            

            

            <code class="ruby">    if !@cursor.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="323" data-linenumber="57">
            <span class="hits">323</span>
            

            

            <code class="ruby">      params[:cursor] = @cursor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="61">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def extract_query_params params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="62">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params = params.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="63">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :action</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="64">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :controller</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="65">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :format</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="66">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :utf8</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="67">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :spatial_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="68">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :commit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="69">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :collection_cursor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="70">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :collection_number_of_results</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="72">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params[:dataset_id] = params[:datasetId]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="73">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :datasetId</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">    # Remove facet parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="76">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :facetLimit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="77">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :facetCount</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="78">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :facetStart</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="79">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params.delete :facetSort</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="347" data-linenumber="80">
            <span class="hits">347</span>
            

            

            <code class="ruby">    query_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d227cc5c24f0ea2c358bb28791b1e52184c6c0aa">
  <div class="header">
    <h3>app/controllers/collections_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>76</b> relevant lines.
      <span class="green"><b>76</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class CollectionsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="2">
            <span class="hits">2</span>
            

            

            <code class="ruby">  respond_to :xml, :only =&gt; :descriptor_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            <span class="hits">2</span>
            

            

            <code class="ruby">  respond_to :xml, :only =&gt; :descriptor_document_facets</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  respond_to :atom, :html, :only =&gt; :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">  # GET datasets/descriptor_document.xml</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def descriptor_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="8">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @client_id_model = ClientId.new(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="10">
            <span class="hits">8</span>
            

            

            <code class="ruby">    @type = &#39;datasets&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="12">
            <span class="hits">8</span>
            

            

            <code class="ruby">    if @client_id_model.valid?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="13">
            <span class="hits">5</span>
            

            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="14">
            <span class="hits">5</span>
            

            

            <code class="ruby">        format.xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="17">
            <span class="hits">3</span>
            

            

            <code class="ruby">      error_msg = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="18">
            <span class="hits">6</span>
            

            

            <code class="ruby">      @client_id_model.errors.full_messages.each { |value| error_msg += &quot;#{value}\n&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="19">
            <span class="hits">3</span>
            

            

            <code class="ruby">      flash.now[:error] = error_msg.chop!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="20">
            <span class="hits">3</span>
            

            

            <code class="ruby">      render &#39;home/index.html.erb&#39;, :status =&gt; :bad_request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="24">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def descriptor_document_facets</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="25">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @client_id_model = ClientId.new(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="27">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @type = &#39;datasets&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="29">
            <span class="hits">3</span>
            

            

            <code class="ruby">    if @client_id_model.valid?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="30">
            <span class="hits">2</span>
            

            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            <span class="hits">2</span>
            

            

            <code class="ruby">        format.xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">      error_msg = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="35">
            <span class="hits">2</span>
            

            

            <code class="ruby">      @client_id_model.errors.full_messages.each { |value| error_msg += &quot;#{value}\n&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            <span class="hits">1</span>
            

            

            <code class="ruby">      flash.now[:error] = error_msg.chop!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            <span class="hits">1</span>
            

            

            <code class="ruby">      render &#39;home/index.html.erb&#39;, :status =&gt; :bad_request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  # GET collections.[atom|html]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="42">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="43">
            <span class="hits">201</span>
            

            

            <code class="ruby">    time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="44">
            <span class="hits">201</span>
            

            

            <code class="ruby">      extract_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            
            

            

            <code class="ruby">      # Cwic-User = test will provide links to CWIC OSDDs for datasets that are not yet public</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="46">
            <span class="hits">201</span>
            

            

            <code class="ruby">      cwic_testing = request.headers[&#39;Cwic-User&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="47">
            <span class="hits">201</span>
            

            

            <code class="ruby">      if !cwic_testing.nil? &amp;&amp; cwic_testing.upcase == &#39;TEST&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="48">
            <span class="hits">4</span>
            

            

            <code class="ruby">        cwic_testing = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="197" data-linenumber="50">
            <span class="hits">197</span>
            

            

            <code class="ruby">        cwic_testing = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="53">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @has_granules_type = params[:hasGranules] || nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="54">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @is_cwic_type = params[:isCwic] || nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="55">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @is_geoss_type = params[:isGeoss] || nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="56">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @is_ceos_type = params[:isCeos] || nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="57">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @is_eosdis_type = params[:isEosdis] || nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="58">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @is_fedeo_type = params[:isFedeo] || nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="59">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @collection_models = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="60">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @number_of_hits = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="61">
            <span class="hits">201</span>
            

            

            <code class="ruby">      @collection = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="62">
            <span class="hits">201</span>
            

            

            <code class="ruby">      facet_processing_required = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="64">
            <span class="hits">201</span>
            

            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="65">
            <span class="hits">201</span>
            

            

            <code class="ruby">        @time = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="66">
            <span class="hits">201</span>
            

            

            <code class="ruby">        collections = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="67">
            <span class="hits">201</span>
            

            

            <code class="ruby">        query_params = extract_query_params params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="68">
            <span class="hits">201</span>
            

            

            <code class="ruby">        @collection = Collection.new(query_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="69">
            <span class="hits">201</span>
            

            

            <code class="ruby">        if @collection.valid?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">          # do not affect the OpenSearch param validation and only apply facets to datasets</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="71">
            <span class="hits">185</span>
            

            

            <code class="ruby">          facet_params = Facet.extract_facet_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="72">
            <span class="hits">185</span>
            

            

            <code class="ruby">          facet_processing_required = Facet.processing_required(facet_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="73">
            <span class="hits">185</span>
            

            

            <code class="ruby">          if (facet_processing_required)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="74">
            <span class="hits">9</span>
            

            

            <code class="ruby">            query_params[:include_facets] = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="76">
            <span class="hits">185</span>
            

            

            <code class="ruby">          collections = @collection.find(query_params, request.original_url, request.format == :atom, cwic_testing)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="78">
            <span class="hits">177</span>
            

            

            <code class="ruby">          @number_of_hits = Collection.hits collections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="79">
            <span class="hits">177</span>
            

            

            <code class="ruby">          @client_id = params[:clientId] || &#39;unknown&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="81">
            <span class="hits">177</span>
            

            

            <code class="ruby">          if request.format == :html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="82">
            <span class="hits">78</span>
            

            

            <code class="ruby">            @client_id = &#39;our_html_ui&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="83">
            <span class="hits">78</span>
            

            

            <code class="ruby">            @collection_models = Collection.to_html_model collections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="87">
            <span class="hits">8</span>
            

            

            <code class="ruby">        Rails.logger.error &quot;Client ID &#39;#{params[:clientId]}&#39; collection search error: &quot; + e.inspect</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="90">
            <span class="hits">201</span>
            

            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="91">
            <span class="hits">201</span>
            

            

            <code class="ruby">        format.atom do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="107" data-linenumber="92">
            <span class="hits">107</span>
            

            

            <code class="ruby">          if @collection.valid? &amp;&amp; !collections.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="93">
            <span class="hits">99</span>
            

            

            <code class="ruby">            if (facet_processing_required)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="94">
            <span class="hits">9</span>
            

            

            <code class="ruby">              Facet.process_facet_search(collections, facet_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="96">
            <span class="hits">99</span>
            

            

            <code class="ruby">            text = collections.to_xml(:indent =&gt; 2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="97">
            <span class="hits">99</span>
            

            

            <code class="ruby">            render :plain =&gt; text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="99">
            <span class="hits">8</span>
            

            

            <code class="ruby">            if @collection.errors.count &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="100">
            <span class="hits">7</span>
            

            

            <code class="ruby">              text = @collection.errors.to_xml(:indent =&gt; 2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="101">
            <span class="hits">7</span>
            

            

            <code class="ruby">              render :plain =&gt; text, :status =&gt; :bad_request and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            <span class="hits">1</span>
            

            

            <code class="ruby">              Rails.logger.error &quot;Collection search exception: #{e}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            <span class="hits">1</span>
            

            

            <code class="ruby">              if (!e.nil? &amp;&amp; !e.response.code.nil?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">                # need separate rendering for exceptions since they cannot be added to ActiveModel errors modified hash</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            <span class="hits">1</span>
            

            

            <code class="ruby">                render :plain =&gt; e.response, :status =&gt; e.response.code and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">              end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="111">
            <span class="hits">201</span>
            

            

            <code class="ruby">        format.html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="193" data-linenumber="114">
            <span class="hits">193</span>
            

            

            <code class="ruby">    Rails.logger.info log_performance(&#39;Collection search&#39;, time, @number_of_hits)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="117">
            <span class="hits">2</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="119">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def extract_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="120">
            <span class="hits">201</span>
            

            

            <code class="ruby">    extract_common_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">end      </code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="89f947c7f292eecc633520311d0321748187673b">
  <div class="header">
    <h3>app/controllers/granules_controller.rb</h3>
    <h4>
      <span class="green">
  96.3%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>81</b> relevant lines.
      <span class="green"><b>78</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class GranulesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="2">
            <span class="hits">2</span>
            

            

            <code class="ruby">  include GranulesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            <span class="hits">2</span>
            

            

            <code class="ruby">  respond_to :xml, :only =&gt; :descriptor_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  respond_to :atom, :html, :only =&gt; :index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">  # GET granules/descriptor_document.xml</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def descriptor_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="8">
            <span class="hits">21</span>
            

            

            <code class="ruby">    @client_id_model = ClientId.new(params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="10">
            <span class="hits">21</span>
            

            

            <code class="ruby">    @collection_concept_id = params[:collectionConceptId].blank? ? nil : params[:collectionConceptId]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="11">
            <span class="hits">21</span>
            

            

            <code class="ruby">    @short_name = params[:shortName].blank? ? &#39;{echo:shortName?}&#39; : params[:shortName]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="12">
            <span class="hits">21</span>
            

            

            <code class="ruby">    @version_id = params[:versionId].blank? ? &#39;{echo:versionId?}&#39; : params[:versionId]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="13">
            <span class="hits">21</span>
            

            

            <code class="ruby">    @data_center = params[:dataCenter].blank? ? &#39;{echo:dataCenter?}&#39; : params[:dataCenter]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="15">
            <span class="hits">21</span>
            

            

            <code class="ruby">    @type = &#39;granules&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="16">
            <span class="hits">21</span>
            

            

            <code class="ruby">    if @client_id_model.valid?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="17">
            <span class="hits">19</span>
            

            

            <code class="ruby">      if @collection_concept_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="18">
            <span class="hits">10</span>
            

            

            <code class="ruby">        mapping_hash = parse_cwic_mapping_by_concept_id(@collection_concept_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            <span class="hits">10</span>
            

            

            <code class="ruby">        if mapping_hash[&#39;erb_file&#39;].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="20">
            <span class="hits">9</span>
            

            

            <code class="ruby">          if mapping_hash[&#39;dataset_id&#39;].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="21">
            <span class="hits">9</span>
            

            

            <code class="ruby">            @dataset_id = URI.encode mapping_hash[&#39;dataset_id&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="22">
            <span class="hits">9</span>
            

            

            <code class="ruby">            @geo_box = mapping_hash[&#39;geo_box&#39;].include?(&quot;unknown&quot;) ? &#39;{geo:box}&#39; : mapping_hash[&#39;geo_box&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="23">
            <span class="hits">9</span>
            

            

            <code class="ruby">            @begin = mapping_hash[&#39;begin&#39;] == &quot;unknown&quot; ? &#39;1970-01-01T00:00:00Z&#39; : mapping_hash[&#39;begin&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="24">
            <span class="hits">9</span>
            

            

            <code class="ruby">            @end = mapping_hash[&#39;end&#39;] == &quot;unknown&quot; ? &#39;2030-01-01T00:00:00Z&#39; : mapping_hash[&#39;end&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="25">
            <span class="hits">9</span>
            

            

            <code class="ruby">            render mapping_hash[&#39;erb_file&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">            error_msg = &quot;Unable to find dataset_id for #{@collection_concept_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">            flash.now[:error] = error_msg.chop!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">            render &#39;home/index.html.erb&#39;, :status =&gt; :bad_request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">          error_msg = &quot;Unable to find mapping for collectionConceptId #{@collection_concept_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">          flash.now[:error] = error_msg.chop!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">          render &#39;home/index.html.erb&#39;, :status =&gt; :bad_request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="37">
            <span class="hits">9</span>
            

            

            <code class="ruby">        respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="38">
            <span class="hits">9</span>
            

            

            <code class="ruby">          format.xml</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="42">
            <span class="hits">2</span>
            

            

            <code class="ruby">      error_msg = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="43">
            <span class="hits">4</span>
            

            

            <code class="ruby">      @client_id_model.errors.full_messages.each {|value| error_msg += &quot;#{value}\n&quot;}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            <span class="hits">2</span>
            

            

            <code class="ruby">      flash.now[:error] = error_msg.chop!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            <span class="hits">2</span>
            

            

            <code class="ruby">      render &#39;home/index.html.erb&#39;, :status =&gt; :bad_request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  # GET all granules.[atom|html]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  # the commit = Search parameter indicates a form submission</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  # on a form submission we do not allow searches without the collection shortname or conceptid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="52">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">    # if two_step_search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="54">
            <span class="hits">146</span>
            

            

            <code class="ruby">      @time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">        # do not allow the unrestricted granule seach if via the granule search form unless accessed as step 2 of a 2 step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">        # search, where step 1 narrows down the search to a collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">        # Unrestricted granule searches are allowed via the API</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="58">
            <span class="hits">146</span>
            

            

            <code class="ruby">        is_two_step_search = two_step_search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="59">
            <span class="hits">146</span>
            

            

            <code class="ruby">        extract_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="61">
            <span class="hits">146</span>
            

            

            <code class="ruby">        @granule_models = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="62">
            <span class="hits">146</span>
            

            

            <code class="ruby">        @number_of_hits = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="64">
            <span class="hits">146</span>
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="65">
            <span class="hits">146</span>
            

            

            <code class="ruby">          granules = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="66">
            <span class="hits">146</span>
            

            

            <code class="ruby">          query_params = extract_query_params params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="67">
            <span class="hits">146</span>
            

            

            <code class="ruby">          @granule = Granule.new(query_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="68">
            <span class="hits">146</span>
            

            

            <code class="ruby">          if (params[:commit] == &#39;Search&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">            # validate form submission and avoid resource intensive searches while allowing them if invoked vai the OpenSearch API</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="70">
            <span class="hits">37</span>
            

            

            <code class="ruby">            @granule.invokedFromSearchForm = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="109" data-linenumber="72">
            <span class="hits">109</span>
            

            

            <code class="ruby">            @granule.invokedFromSearchForm = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">          # allow the unrestricted granule search only via the OpenSearch ATOM API or via the granule HTML search form if</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">          # a.  The search is part of a two step search OR</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">          # b.  The search is invoked directly and it has the required search parameters (Collection Concept IF, Short name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">          # or Unique ID) which are part of the granule model validation specific to a form submission</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="78">
            <span class="hits">146</span>
            

            

            <code class="ruby">          if @granule.valid? &amp;&amp; (is_two_step_search || request.format == &#39;application/atom+xml&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="79">
            <span class="hits">93</span>
            

            

            <code class="ruby">            granules = @granule.find(query_params, request.original_url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="81">
            <span class="hits">91</span>
            

            

            <code class="ruby">            @number_of_hits = Granule.hits granules</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="82">
            <span class="hits">91</span>
            

            

            <code class="ruby">            @client_id = params[:clientId] || &#39;unknown&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="84">
            <span class="hits">91</span>
            

            

            <code class="ruby">            if request.format == :html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="85">
            <span class="hits">31</span>
            

            

            <code class="ruby">              @client_id = &#39;our_html_ui&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="86">
            <span class="hits">31</span>
            

            

            <code class="ruby">              @granule_models = Granule.to_html_model granules</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">        rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="92">
            <span class="hits">2</span>
            

            

            <code class="ruby">          Rails.logger.error &quot;Client ID &#39;#{params[:clientId]}&#39; granule search error: &quot; + e.inspect</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="94">
            <span class="hits">146</span>
            

            

            <code class="ruby">        respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="95">
            <span class="hits">146</span>
            

            

            <code class="ruby">          format.atom do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="96">
            <span class="hits">69</span>
            

            

            <code class="ruby">            text = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="97">
            <span class="hits">69</span>
            

            

            <code class="ruby">            if @granule.valid? &amp;&amp; !granules.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="98">
            <span class="hits">60</span>
            

            

            <code class="ruby">              text = granules.to_xml(:indent =&gt; 2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="99">
            <span class="hits">60</span>
            

            

            <code class="ruby">              render :plain =&gt; text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="101">
            <span class="hits">9</span>
            

            

            <code class="ruby">              if @granule.errors.count &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="102">
            <span class="hits">8</span>
            

            

            <code class="ruby">                text = @granule.errors.to_xml(:indent =&gt; 2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="103">
            <span class="hits">8</span>
            

            

            <code class="ruby">                if (text.include?(&quot;is not supported&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            <span class="hits">1</span>
            

            

            <code class="ruby">                  render :plain =&gt; text, :status =&gt; :not_implemented</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">                else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="106">
            <span class="hits">7</span>
            

            

            <code class="ruby">                  render :plain =&gt; text, :status =&gt; :bad_request and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">                end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby">              else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            <span class="hits">1</span>
            

            

            <code class="ruby">                if (!e.nil? &amp;&amp; !e.response.code.nil?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">                  # need separate rendering for exceptions since they cannot be added to ActiveModel errors modified hash</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            <span class="hits">1</span>
            

            

            <code class="ruby">                  render :plain =&gt; e.response, :status =&gt; e.response.code and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">                end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">              end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="116">
            <span class="hits">146</span>
            

            

            <code class="ruby">          format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="117">
            <span class="hits">77</span>
            

            

            <code class="ruby">            if @client_id.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="118">
            <span class="hits">36</span>
            

            

            <code class="ruby">              @client_id = &#39;our_html_ui&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="138" data-linenumber="122">
            <span class="hits">138</span>
            

            

            <code class="ruby">        Rails.logger.info log_performance(&#39;Granule search&#39;, @time, @number_of_hits)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">    #else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">    #  respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">    #    format.html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">    #  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">    #end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="131">
            <span class="hits">2</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="133">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def extract_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="134">
            <span class="hits">146</span>
            

            

            <code class="ruby">    extract_common_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="136">
            <span class="hits">146</span>
            

            

            <code class="ruby">    session[:collection_cursor] = params[:collection_cursor] unless params[:collection_cursor].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="137">
            <span class="hits">146</span>
            

            

            <code class="ruby">    session[:collection_number_of_results] = params[:collection_number_of_results] unless params[:collection_number_of_results].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  # the granule search form can be accessed directly without going through the recommended two-step search approach:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">  # step 1: search for collections and identify the collection of interest</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">  # step 2: search for granules ONLY in the collection of interest indentified in step 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="144">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def two_step_search</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="145">
            <span class="hits">146</span>
            

            

            <code class="ruby">    ret_val = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="146">
            <span class="hits">146</span>
            

            

            <code class="ruby">    if params.values.size == 2 &amp;&amp; params[&#39;action&#39;] == &#39;index&#39; &amp;&amp; params[&#39;controller&#39;] == &#39;granules&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="147">
            <span class="hits">36</span>
            

            

            <code class="ruby">      ret_val = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="146" data-linenumber="149">
            <span class="hits">146</span>
            

            

            <code class="ruby">    return ret_val</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d22f63fc13a829b854d7ba477343b1d81a8c2bb4">
  <div class="header">
    <h3>app/controllers/health_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">class HealthController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            <span class="hits">1</span>
            

            

            <code class="ruby">  respond_to :json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="5">
            <span class="hits">2</span>
            

            

            <code class="ruby">    health = Health.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="6">
            <span class="hits">2</span>
            

            

            <code class="ruby">    response = &quot;{\&quot;cmr-search\&quot;:{\&quot;ok?\&quot;:#{health.ok?}}}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="8">
            <span class="hits">2</span>
            

            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="9">
            <span class="hits">2</span>
            

            

            <code class="ruby">        render :plain =&gt; response, :status =&gt; health.ok? ? :ok : :service_unavailable</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="744b752e3ec4f9c8b23a1704d4e60f4928a04c5c">
  <div class="header">
    <h3>app/controllers/home_controller.rb</h3>
    <h4>
      <span class="red">
  80.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class HomeController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def cwic_mapping</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            
            

            

            <code class="ruby">    render &#39;home/cwic-mapping.xml&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def docs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e986225286cbf2378c7bd93408d13625563266b5">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  98.73%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>79</b> relevant lines.
      <span class="green"><b>78</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def start_hit (cursor, number_of_results, number_of_hits)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="3">
            <span class="hits">161</span>
            

            

            <code class="ruby">    start_hit = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="4">
            <span class="hits">161</span>
            

            

            <code class="ruby">    if cursor.to_i == 1 &amp;&amp; number_of_hits.to_i &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="5">
            <span class="hits">90</span>
            

            

            <code class="ruby">      start_hit = 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="6">
            <span class="hits">71</span>
            

            

            <code class="ruby">    elsif number_of_hits.to_i &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">      start_hit = ((cursor.to_i - 1) * number_of_results.to_i) + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="9">
            <span class="hits">161</span>
            

            

            <code class="ruby">    start_hit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def stop_hit (cursor, length, number_of_results, number_of_hits)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">    #cursor = 1 if cursor &lt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="483" data-linenumber="14">
            <span class="hits">483</span>
            

            

            <code class="ruby">    stop_hit = (cursor.to_i - 1) * number_of_results.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="483" data-linenumber="15">
            <span class="hits">483</span>
            

            

            <code class="ruby">    stop_hit += number_of_results.to_i if cursor.to_i &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="483" data-linenumber="17">
            <span class="hits">483</span>
            

            

            <code class="ruby">    stop_hit = 0 if stop_hit &lt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="483" data-linenumber="18">
            <span class="hits">483</span>
            

            

            <code class="ruby">    stop_hit = number_of_results.to_i if stop_hit == 0 and number_of_results.to_i &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="483" data-linenumber="19">
            <span class="hits">483</span>
            

            

            <code class="ruby">    stop_hit = number_of_hits if stop_hit &gt; number_of_hits.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="483" data-linenumber="20">
            <span class="hits">483</span>
            

            

            <code class="ruby">    stop_hit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def previous_page(cursor)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="322" data-linenumber="24">
            <span class="hits">322</span>
            

            

            <code class="ruby">    cursor.to_i - 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def next_page(cursor)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">    cursor.to_i + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def render_temporal_extent(range)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">    # Example: 1951-01-01T00:00:00Z/1952-12-01T00:00:00Z</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="407" data-linenumber="33">
            <span class="hits">407</span>
            

            

            <code class="ruby">    markup = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="407" data-linenumber="34">
            <span class="hits">407</span>
            

            

            <code class="ruby">    unless range.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="35">
            <span class="hits">145</span>
            

            

            <code class="ruby">      start = range.split(&#39;/&#39;)[0]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="36">
            <span class="hits">145</span>
            

            

            <code class="ruby">      stop = range.split(&#39;/&#39;)[1]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="37">
            <span class="hits">145</span>
            

            

            <code class="ruby">      markup = &#39;&lt;div&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="38">
            <span class="hits">145</span>
            

            

            <code class="ruby">      markup += &quot;&lt;div class=&#39;group-meta&#39;&gt;&lt;span&gt;Start:&lt;/span&gt; &lt;span class=&#39;temporal-extent-start&#39;&gt;#{start}&lt;/span&gt;&lt;/div&gt;&quot; unless start.nil? or start.to_str.nil? or start == &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="39">
            <span class="hits">145</span>
            

            

            <code class="ruby">      markup += &quot;&lt;div class=&#39;group-meta&#39;&gt;&lt;span&gt;End:&lt;/span&gt; &lt;span class=&#39;temporal-extent-end&#39;&gt;#{stop}&lt;/span&gt;&lt;/div&gt;&quot; unless stop.nil? or stop.to_str.nil? or stop == &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="40">
            <span class="hits">145</span>
            

            

            <code class="ruby">      markup += &#39;&lt;/div&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="407" data-linenumber="42">
            <span class="hits">407</span>
            

            

            <code class="ruby">    markup.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def render_spatial_extent(bounding_box, polygon, line, point)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="407" data-linenumber="46">
            <span class="hits">407</span>
            

            

            <code class="ruby">    markup = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="407" data-linenumber="47">
            <span class="hits">407</span>
            

            

            <code class="ruby">    unless bounding_box.nil? and polygon.nil? and line.nil? and point.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="48">
            <span class="hits">24</span>
            

            

            <code class="ruby">      markup = &#39;&lt;div&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="49">
            <span class="hits">24</span>
            

            

            <code class="ruby">      markup += &quot;&lt;div class=&#39;group-meta&#39;&gt;&lt;span&gt;Minimum Bounding Rectangle:&lt;/span&gt; &lt;span class=&#39;spatial-extent&#39;&gt;#{bounding_box.to_str}&lt;/span&gt;&lt;/div&gt;&quot; unless bounding_box.nil? or bounding_box.to_str.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="50">
            <span class="hits">24</span>
            

            

            <code class="ruby">      markup += &quot;&lt;div class=&#39;group-meta&#39;&gt;&lt;span&gt;Polygon:&lt;/span&gt; &lt;span class=&#39;spatial-extent&#39;&gt;#{polygon.to_str}&lt;/span&gt;&lt;/div&gt;&quot; unless polygon.nil? or polygon.to_str.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="51">
            <span class="hits">24</span>
            

            

            <code class="ruby">      markup += &quot;&lt;div class=&#39;group-meta&#39;&gt;&lt;span&gt;Line:&lt;/span&gt; &lt;span class=&#39;spatial-extent&#39;&gt;#{line.to_str}&lt;/span&gt;&lt;/div&gt;&quot; unless line.nil? or line.to_str.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="52">
            <span class="hits">24</span>
            

            

            <code class="ruby">      markup += &quot;&lt;div class=&#39;group-meta&#39;&gt;&lt;span&gt;Point:&lt;/span&gt; &lt;span class=&#39;spatial-extent&#39;&gt;#{point.to_str}&lt;/span&gt;&lt;/div&gt;&quot; unless point.nil? or point.to_str.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="53">
            <span class="hits">24</span>
            

            

            <code class="ruby">      markup += &#39;&lt;/div&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="407" data-linenumber="55">
            <span class="hits">407</span>
            

            

            <code class="ruby">    markup.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def spatial_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="59">
            <span class="hits">161</span>
            

            

            <code class="ruby">    spatial_types = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="60">
            <span class="hits">161</span>
            

            

            <code class="ruby">    bb = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="61">
            <span class="hits">161</span>
            

            

            <code class="ruby">    bb.id = &#39;bbox&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="62">
            <span class="hits">161</span>
            

            

            <code class="ruby">    bb.name = &#39;Bounding box&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="63">
            <span class="hits">161</span>
            

            

            <code class="ruby">    spatial_types &lt;&lt; bb</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="65">
            <span class="hits">161</span>
            

            

            <code class="ruby">    geometry = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="66">
            <span class="hits">161</span>
            

            

            <code class="ruby">    geometry.id = &#39;geometry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="67">
            <span class="hits">161</span>
            

            

            <code class="ruby">    geometry.name = &#39;Geometry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="68">
            <span class="hits">161</span>
            

            

            <code class="ruby">    spatial_types &lt;&lt; geometry</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="70">
            <span class="hits">161</span>
            

            

            <code class="ruby">    place_name = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="71">
            <span class="hits">161</span>
            

            

            <code class="ruby">    place_name.id = &#39;placename&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="72">
            <span class="hits">161</span>
            

            

            <code class="ruby">    place_name.name = &#39;Place Name&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="73">
            <span class="hits">161</span>
            

            

            <code class="ruby">    spatial_types &lt;&lt; place_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="161" data-linenumber="75">
            <span class="hits">161</span>
            

            

            <code class="ruby">    spatial_types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def boolean_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="79">
            <span class="hits">92</span>
            

            

            <code class="ruby">    boolean_types = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="81">
            <span class="hits">92</span>
            

            

            <code class="ruby">    either = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="82">
            <span class="hits">92</span>
            

            

            <code class="ruby">    either.id = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="83">
            <span class="hits">92</span>
            

            

            <code class="ruby">    either.name = &#39;Either&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="84">
            <span class="hits">92</span>
            

            

            <code class="ruby">    boolean_types &lt;&lt; either</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="86">
            <span class="hits">92</span>
            

            

            <code class="ruby">    yes = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="87">
            <span class="hits">92</span>
            

            

            <code class="ruby">    yes.id = &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="88">
            <span class="hits">92</span>
            

            

            <code class="ruby">    yes.name = &#39;Yes&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="89">
            <span class="hits">92</span>
            

            

            <code class="ruby">    boolean_types &lt;&lt; yes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="91">
            <span class="hits">92</span>
            

            

            <code class="ruby">    no = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="92">
            <span class="hits">92</span>
            

            

            <code class="ruby">    no.id = &#39;false&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="93">
            <span class="hits">92</span>
            

            

            <code class="ruby">    no.name = &#39;No&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="94">
            <span class="hits">92</span>
            

            

            <code class="ruby">    boolean_types &lt;&lt; no</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="96">
            <span class="hits">92</span>
            

            

            <code class="ruby">    boolean_types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def true_only_types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="100">
            <span class="hits">460</span>
            

            

            <code class="ruby">      boolean_types = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="102">
            <span class="hits">460</span>
            

            

            <code class="ruby">      either = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="103">
            <span class="hits">460</span>
            

            

            <code class="ruby">      either.id = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="104">
            <span class="hits">460</span>
            

            

            <code class="ruby">      either.name = &#39;Don\&#39;t care&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="105">
            <span class="hits">460</span>
            

            

            <code class="ruby">      boolean_types &lt;&lt; either</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="107">
            <span class="hits">460</span>
            

            

            <code class="ruby">      yes = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="108">
            <span class="hits">460</span>
            

            

            <code class="ruby">      yes.id = &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="109">
            <span class="hits">460</span>
            

            

            <code class="ruby">      yes.name = &#39;Yes&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="460" data-linenumber="110">
            <span class="hits">460</span>
            

            

            <code class="ruby">      boolean_types &lt;&lt; yes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="893f6da6526767538085b0e1fc94dc7c5a6ad8be">
  <div class="header">
    <h3>app/helpers/collections_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">module CollectionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def truncate_link(link)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="3">
            <span class="hits">66</span>
            

            

            <code class="ruby">    title = link.title ? link.title : &#39;undefined&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="4">
            <span class="hits">66</span>
            

            

            <code class="ruby">    markup = &quot;&lt;a target=&#39;_blank&#39; class=&#39;ext&#39; href=&#39;#{link.href}&#39; title=&#39;#{link.title}&#39;&gt;#{title.truncate(64)}&lt;/a&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="5">
            <span class="hits">66</span>
            

            

            <code class="ruby">    markup.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="89ee02f55671eabed2f0770f88876be559e52091">
  <div class="header">
    <h3>app/helpers/granules_helper.rb</h3>
    <h4>
      <span class="red">
  15.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>20</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">module GranulesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def get_provider_from_concept_id(collection_concept_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            
            

            

            <code class="ruby">    collection_concept_id.split(&#39;-&#39;)[1].strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def parse_cwic_mapping_by_concept_id(concept_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            
            

            

            <code class="ruby">    cwic_mapping_doc_loc = &quot;cwic-mapping.xml&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">    if Rails.cache.read(&quot;cwic_mapping&quot;).nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">      cwic_mapping_doc =  File.open(cwic_mapping_doc_loc) { |f| Nokogiri::XML(f) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">      Rails.cache.write(&quot;cwic_mapping&quot;, cwic_mapping_doc.serialize, expires_in: 24.hours)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">      cwic_mapping_doc = Nokogiri::XML(Rails.cache.read(&quot;cwic_mapping&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    provider = cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/../@id&quot;).text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    mapping_hash = Hash.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    if provider.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      if provider == &quot;NASA&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">        mapping_hash[&#39;erb_file&#39;] = &quot;descriptor_document.xml.erb&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">        mapping_hash[&#39;erb_file&#39;] = &quot;#{provider.downcase}.xml.erb&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        mapping_hash[&#39;dataset_id&#39;] = cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/@datasetId&quot;).text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">        mapping_hash[&#39;begin&#39;] = cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/@begin&quot;).text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">        mapping_hash[&#39;end&#39;] = cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/@end&quot;).text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">        mapping_hash[&#39;geo_box&#39;] = &quot;#{cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/@west&quot;).text},&quot;\</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">                                  &quot;#{cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/@south&quot;).text},&quot;\</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">                                  &quot;#{cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/@east&quot;).text},&quot;\</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">                                  &quot;#{cwic_mapping_doc.xpath(&quot;/mappingList/catalog/dataSet[@conceptId=\&quot;#{concept_id}\&quot;]/@north&quot;).text}&quot;;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    mapping_hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="aec615579c20a27698a88bafcf536409d48a87a5">
  <div class="header">
    <h3>app/helpers/home_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">module HomeHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8ca87cb08695718d87b513350ea9a5608ef71936">
  <div class="header">
    <h3>app/jobs/job_base.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1">
            
            

            

            <code class="ruby">class JobBase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            
            

            

            <code class="ruby">  def run()</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">      execute</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            
            

            

            <code class="ruby">    rescue =&gt; exception</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            
            

            

            <code class="ruby">      Rails.logger.error(&quot;Caught exception in scheduled job #{self.class.name}: #{exception.message}\n#{exception.inspect}\n#{exception.backtrace.join(&quot;\n&quot;)}\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">      ActiveRecord::Base.connection_pool.release_connection if ActiveRecord::Base.connection_pool.active_connection?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5d0dcffe7bbf5fa1a200318594a4506099cd2a83">
  <div class="header">
    <h3>app/jobs/memory_profiler.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1">
            
            

            

            <code class="ruby">class MemoryProfiler &lt; JobBase</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="2">
            
            

            

            <code class="ruby">  def execute</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            
            

            

            <code class="ruby">    Rails.logger.info(&quot;Memory Stats Profile: #{GC.stat}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            
            

            

            <code class="ruby">    Rails.logger.info(&quot;Connection pool size: #{ActiveRecord::Base.connection_pool.connections.size}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">    Rails.logger.info(&quot;Starting Database Polling&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">    #Rails.logger.info(&quot;Current Thread Connection Auto Commit: #{ActiveRecord::Base.connection.raw_connection.auto_commit}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            
            

            

            <code class="ruby">    ActiveRecord::Base.connection_pool.connections.each_with_index { |connection,number| Rails.logger.info(&quot;Connection Number:#{number + 1} Open Transactions:#{connection.open_transactions.to_s} Last Used: #{Time.now - connection.last_use}s ago&quot;)}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="471129b7d1ad8996aed27d3856812716d5361e70">
  <div class="header">
    <h3>app/models/ceos_agency.rb</h3>
    <h4>
      <span class="green">
  96.77%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">class CeosAgency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            <span class="hits">1</span>
            

            

            <code class="ruby">  attr_accessor :name, :data_centers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">  # JSON string format is:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby">  # &#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">  #{</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">  #    &quot;name&quot;: &quot;ceos_agency_11&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby">  #    &quot;data_centers&quot;: [&quot;DC1&quot;, &quot;DC2&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  #}&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def initialize(json_string)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="11">
            <span class="hits">25</span>
            

            

            <code class="ruby">    json_hash = JSON.parse(json_string)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="12">
            <span class="hits">25</span>
            

            

            <code class="ruby">    @name = json_hash[&#39;name&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="13">
            <span class="hits">25</span>
            

            

            <code class="ruby">    @data_centers = json_hash[&#39;data_centers&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  # JSON array format is:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  #[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  #&#39;{</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">  #        &quot;name&quot;: &quot;ceos_agency_1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">  #        &quot;data_centers&quot;: [&quot;DC1&quot;, &quot;DC2&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  #      }&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">  #    &#39;{</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">  #        &quot;name&quot;: &quot;ceos_agency_2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  #        &quot;data_centers&quot;: [&quot;DC3&quot;, &quot;DC4&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  #      }&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  #]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def self.create_all_ceos_agencies_cmr_query_string(array_of_json_strings)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="28">
            <span class="hits">2</span>
            

            

            <code class="ruby">    cmr_query_params = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="29">
            <span class="hits">2</span>
            

            

            <code class="ruby">    query_data_centers = cmr_query_params[&#39;data_center&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">    #query_archive_centers = cmr_query_params[&#39;archive_center&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            <span class="hits">2</span>
            

            

            <code class="ruby">    ceos_agencies_array = CeosAgency.create_all_ceos_agencies(array_of_json_strings)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="32">
            <span class="hits">2</span>
            

            

            <code class="ruby">    if (ceos_agencies_array != nil &amp;&amp; !ceos_agencies_array.empty?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            <span class="hits">2</span>
            

            

            <code class="ruby">      ceos_agencies_array.each do |ceos_agency|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="34">
            <span class="hits">22</span>
            

            

            <code class="ruby">        agency_data_centers = ceos_agency.data_centers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="35">
            <span class="hits">22</span>
            

            

            <code class="ruby">        if !agency_data_centers.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="36">
            <span class="hits">22</span>
            

            

            <code class="ruby">          agency_data_centers.each do |agency_data_center|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="37">
            <span class="hits">29</span>
            

            

            <code class="ruby">            if query_data_centers.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="38">
            <span class="hits">2</span>
            

            

            <code class="ruby">              query_data_centers = Array.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="40">
            <span class="hits">29</span>
            

            

            <code class="ruby">            query_data_centers &lt;&lt; agency_data_center</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            <span class="hits">2</span>
            

            

            <code class="ruby">      if(query_data_centers != nil &amp;&amp; !query_data_centers.empty?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            <span class="hits">2</span>
            

            

            <code class="ruby">        if cmr_query_params[:data_center].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="46">
            <span class="hits">2</span>
            

            

            <code class="ruby">          cmr_query_params[:data_center] = query_data_centers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">          # add wilcard support for data_center</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            <span class="hits">2</span>
            

            

            <code class="ruby">          if cmr_query_params[&#39;options[data_center][pattern]&#39;].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="49">
            <span class="hits">2</span>
            

            

            <code class="ruby">            cmr_query_params[&#39;options[data_center][pattern]&#39;] = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">          end  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">          cmr_query_params[:data_center].concat(query_data_centers)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="56">
            <span class="hits">2</span>
            

            

            <code class="ruby">    return cmr_query_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby">  # JSON array format is:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  #[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">  #&#39;{</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">  #        &quot;name&quot;: &quot;ceos_agency_1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">  #        &quot;data_centers&quot;: [&quot;DC1&quot;, &quot;DC2&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">  #      }&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  #    &#39;{</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  #        &quot;name&quot;: &quot;ceos_agency_2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">  #        &quot;data_centers&quot;: [&quot;DC3&quot;, &quot;DC4&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  #      }&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">  #]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def self.create_all_ceos_agencies(array_of_ceos_agencies_json_strings)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="71">
            <span class="hits">3</span>
            

            

            <code class="ruby">    all_ceos_agencies = Array.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="72">
            <span class="hits">3</span>
            

            

            <code class="ruby">    array_of_ceos_agencies_json_strings.each do |agency_json_string|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="73">
            <span class="hits">24</span>
            

            

            <code class="ruby">      agency = CeosAgency.new(agency_json_string)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="74">
            <span class="hits">24</span>
            

            

            <code class="ruby">      all_ceos_agencies &lt;&lt; agency</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="76">
            <span class="hits">3</span>
            

            

            <code class="ruby">    return all_ceos_agencies</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fcc39ede66aa59ee82398d5f541177a6afb8a9a2">
  <div class="header">
    <h3>app/models/client_id.rb</h3>
    <h4>
      <span class="green">
  90.91%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class ClientId</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="2">
            <span class="hits">2</span>
            

            

            <code class="ruby">  include ActiveModel::Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            <span class="hits">2</span>
            

            

            <code class="ruby">  include ActiveModel::Conversion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  extend ActiveModel::Naming</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="6">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :clientId</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validates :clientId, :format =&gt; {:with =&gt; /\A[a-zA-Z0-9_\-]+\z/,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby">                                :message =&gt; &quot;is invalid, it must be an alpha-numeric string&quot;}, :allow_blank =&gt; true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="10">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def initialize(attributes = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="11">
            <span class="hits">60</span>
            

            

            <code class="ruby">      attributes.each do |name, value|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="190" data-linenumber="12">
            <span class="hits">190</span>
            

            

            <code class="ruby">        send(&quot;#{name}=&quot;, value) if %w(clientId).include? name.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="16">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def persisted?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f79a3d590749fda47083c07038caf33fffb29a25">
  <div class="header">
    <h3>app/models/collection.rb</h3>
    <h4>
      <span class="green">
  95.62%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>251</b> relevant lines.
      <span class="green"><b>240</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class Collection &lt; Metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :cmr_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :hasGranules, :isCwic, :isGeoss, :isEosdis, :isCeos, :isFedeo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="6">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def find(params, url, for_atom = true, cwic_testing = false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="7">
            <span class="hits">185</span>
            

            

            <code class="ruby">    collections = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="8">
            <span class="hits">185</span>
            

            

            <code class="ruby">    @cmr_params = to_cmr_collection_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="9">
            <span class="hits">185</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;CMR Params: #{cmr_params}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="10">
            <span class="hits">185</span>
            

            

            <code class="ruby">    response = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="11">
            <span class="hits">185</span>
            

            

            <code class="ruby">    time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="12">
            <span class="hits">185</span>
            

            

            <code class="ruby">      query_url = &quot;#{ENV[&#39;catalog_rest_endpoint&#39;]}collections.atom&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="13">
            <span class="hits">185</span>
            

            

            <code class="ruby">      Rails.logger.info &quot;RestClient call to CMR endpoint: #{query_url}?#{cmr_params.to_query}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="14">
            <span class="hits">185</span>
            

            

            <code class="ruby">      response = RestClient::Request.execute :method =&gt; :get, :url =&gt; query_url, :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE, :headers =&gt; {:client_id =&gt; CLIENT_ID, :params =&gt; cmr_params}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="16">
            <span class="hits">177</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;CMR collection search took #{(time.to_f * 1000).round(0)} ms&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="18">
            <span class="hits">177</span>
            

            

            <code class="ruby">    hits = response.headers[:cmr_hits] ? response.headers[:cmr_hits].to_i : 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="19">
            <span class="hits">177</span>
            

            

            <code class="ruby">    elapsed_time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">      # ruby plus nokogiri do not let us overwrite namespace hrefs so we have to do it at the string level</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="21">
            <span class="hits">177</span>
            

            

            <code class="ruby">      doc_as_string = fix_geo_href(response)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="22">
            <span class="hits">177</span>
            

            

            <code class="ruby">      collections = to_open_search_collections(Nokogiri::XML(doc_as_string), hits, params, url, for_atom, cwic_testing)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="24">
            <span class="hits">177</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;Open Search translation took : #{(elapsed_time.to_f * 1000).round(0)} ms&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="25">
            <span class="hits">177</span>
            

            

            <code class="ruby">    collections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">  # There is a reason we don&#39;t simplify this by using xpath. It is really slow over large result sets. Slow enough to generate user complaints.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="29">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.to_html_model collections_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="30">
            <span class="hits">78</span>
            

            

            <code class="ruby">    collections = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="32">
            <span class="hits">78</span>
            

            

            <code class="ruby">    collections_document.root.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1514" data-linenumber="33">
            <span class="hits">1514</span>
            

            

            <code class="ruby">      if node.name == &#39;entry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="389" data-linenumber="34">
            <span class="hits">389</span>
            

            

            <code class="ruby">        collection = create_html_model(node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="389" data-linenumber="35">
            <span class="hits">389</span>
            

            

            <code class="ruby">        collection.has_granules = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="389" data-linenumber="36">
            <span class="hits">389</span>
            

            

            <code class="ruby">        node.children.each do |sub_node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5387" data-linenumber="37">
            <span class="hits">5387</span>
            

            

            <code class="ruby">          collection.short_name = sub_node.content if sub_node.name == &#39;shortName&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5387" data-linenumber="38">
            <span class="hits">5387</span>
            

            

            <code class="ruby">          collection.version_id = sub_node.content if sub_node.name == &#39;versionId&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5387" data-linenumber="39">
            <span class="hits">5387</span>
            

            

            <code class="ruby">          collection.data_center = sub_node.content if sub_node.name == &#39;dataCenter&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5387" data-linenumber="40">
            <span class="hits">5387</span>
            

            

            <code class="ruby">          collection.description = sub_node.content if sub_node.name == &#39;summary&#39; and sub_node[:type] == &#39;text&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5387" data-linenumber="41">
            <span class="hits">5387</span>
            

            

            <code class="ruby">          collection.dc_date = sub_node.content if sub_node.name == &#39;date&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5387" data-linenumber="42">
            <span class="hits">5387</span>
            

            

            <code class="ruby">          collection.mbr = sub_node.content if sub_node.name == &#39;box&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5387" data-linenumber="43">
            <span class="hits">5387</span>
            

            

            <code class="ruby">          collection.has_granules = true if sub_node.name == &#39;hasGranules&#39; &amp;&amp; sub_node.content == &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="389" data-linenumber="45">
            <span class="hits">389</span>
            

            

            <code class="ruby">        collections &lt;&lt; collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="48">
            <span class="hits">78</span>
            

            

            <code class="ruby">    collections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  # There is a reason we don&#39;t simplify this by using xpath. It is really slow over large result sets. Slow enough to generate user complaints.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="52">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_open_search_collections(document, hits, params, url, for_atom = true, cwic_testing = false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">    # Insert granules descriptor document link</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="54">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc, subtitle_node = to_open_search_common(document, hits, params, &#39;collection&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="55">
            <span class="hits">189</span>
            

            

            <code class="ruby">    granule_osdd_link = add_link_as_sibling(doc, subtitle_node, &quot;#{ ENV[&#39;opensearch_url&#39;]}/granules/descriptor_document.xml&quot;, &#39;application/opensearchdescription+xml&#39;, NEW_REL_MAPPING[:search])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="56">
            <span class="hits">189</span>
            

            

            <code class="ruby">    add_nav_links(doc, granule_osdd_link, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="58">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.root.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4926" data-linenumber="59">
            <span class="hits">4926</span>
            

            

            <code class="ruby">      if node.name == &#39;title&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="60">
            <span class="hits">189</span>
            

            

            <code class="ruby">        node.content = &#39;CMR collection metadata&#39; if node.content == &#39;CMR dataset metadata&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4926" data-linenumber="62">
            <span class="hits">4926</span>
            

            

            <code class="ruby">      if node.name == &#39;entry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="63">
            <span class="hits">876</span>
            

            

            <code class="ruby">        short_name = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="64">
            <span class="hits">876</span>
            

            

            <code class="ruby">        version_id = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="65">
            <span class="hits">876</span>
            

            

            <code class="ruby">        data_center = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="66">
            <span class="hits">876</span>
            

            

            <code class="ruby">        archive_center = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="67">
            <span class="hits">876</span>
            

            

            <code class="ruby">        dif_id = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="68">
            <span class="hits">876</span>
            

            

            <code class="ruby">        guid = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="69">
            <span class="hits">876</span>
            

            

            <code class="ruby">        start_time = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="70">
            <span class="hits">876</span>
            

            

            <code class="ruby">        end_time = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="71">
            <span class="hits">876</span>
            

            

            <code class="ruby">        id = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="72">
            <span class="hits">876</span>
            

            

            <code class="ruby">        id_node = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="73">
            <span class="hits">876</span>
            

            

            <code class="ruby">        mbr = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="74">
            <span class="hits">876</span>
            

            

            <code class="ruby">        has_granules = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="75">
            <span class="hits">876</span>
            

            

            <code class="ruby">        create_cwic_osdd_link = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="76">
            <span class="hits">876</span>
            

            

            <code class="ruby">        is_geoss = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="77">
            <span class="hits">876</span>
            

            

            <code class="ruby">        is_eosdis = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="78">
            <span class="hits">876</span>
            

            

            <code class="ruby">        is_fedeo = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="79">
            <span class="hits">876</span>
            

            

            <code class="ruby">        provider_osdd_link = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">        # mark the collection as CEOS if needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="81">
            <span class="hits">876</span>
            

            

            <code class="ruby">        is_ceos = ceos_collection?(node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="82">
            <span class="hits">876</span>
            

            

            <code class="ruby">        non_atom = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="83">
            <span class="hits">876</span>
            

            

            <code class="ruby">        node.children.each do |entry_node|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="85">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          fix_rel(entry_node) if entry_node.name == &#39;link&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="86">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          add_type(entry_node) if entry_node.name == &#39;link&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="88">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          id_node = entry_node if entry_node.name == &#39;id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">          # this is the CMR concept-id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="90">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          id = entry_node.content if entry_node.name == &#39;id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="92">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          entry_node[:type] = &#39;text&#39; if entry_node.name == &#39;title&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="93">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          entry_node.content = &#39;CMR collection metadata&#39; if entry_node.content == &#39;CMR dataset metadata&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="95">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          provider_osdd_link = provider_granule_osdd_collection_link(entry_node) if provider_osdd_link.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="96">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          short_name = entry_node.content if entry_node.name == &#39;shortName&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="97">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          version_id = entry_node.content if entry_node.name == &#39;versionId&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="98">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          data_center = entry_node.content if entry_node.name == &#39;dataCenter&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="99">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          archive_center = entry_node.content if entry_node.name == &#39;archiveCenter&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="100">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          dif_id = entry_node.content if entry_node.name == &#39;difId&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="101">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          guid = entry_node.content if entry_node.name == &#39;id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="102">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          entry_node.content = &quot;#{ENV[&#39;opensearch_url&#39;]}/collections.atom?uid=#{guid}&quot; if entry_node.name == &#39;id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="103">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          start_time = entry_node.content if entry_node.name == &#39;start&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="104">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          end_time = entry_node.content if entry_node.name == &#39;end&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="105">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          entry_node[:type] = &#39;text&#39; if entry_node.name == &#39;summary&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="106">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          mbr = generate_mbr(doc, entry_node) if entry_node.name == &#39;georss:polygon&#39; || entry_node.name == &#39;georss:line&#39; || entry_node.name == &#39;georss:point&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">          # if node is not an ATOM node then remove it and put it into the array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="108">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          non_atom &lt;&lt; entry_node.remove if !entry_node.namespace.nil? and entry_node.namespace.href != &#39;http://www.w3.org/2005/Atom&#39; or entry_node.name.include? &#39;georss:&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="109">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          has_granules = true if entry_node.name == &#39;hasGranules&#39; &amp;&amp; entry_node.content == &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28410" data-linenumber="110">
            <span class="hits">28410</span>
            

            

            <code class="ruby">          if entry_node.name == &#39;tag&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="111">
            <span class="hits">243</span>
            

            

            <code class="ruby">            create_cwic_osdd_link = cwic_collection?(entry_node, cwic_testing) unless create_cwic_osdd_link == true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="112">
            <span class="hits">243</span>
            

            

            <code class="ruby">            is_geoss = geoss_collection?(entry_node) unless is_geoss == true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="113">
            <span class="hits">243</span>
            

            

            <code class="ruby">            is_eosdis = eosdis_collection?(entry_node) unless is_eosdis == true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="114">
            <span class="hits">243</span>
            

            

            <code class="ruby">            is_fedeo = fedeo_collection?(entry_node) unless is_fedeo == true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="118">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_author(doc, id_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="119">
            <span class="hits">876</span>
            

            

            <code class="ruby">        unless dif_id.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="330" data-linenumber="120">
            <span class="hits">330</span>
            

            

            <code class="ruby">          href = &quot;http://gcmd.nasa.gov/getdif.htm?#{dif_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="330" data-linenumber="121">
            <span class="hits">330</span>
            

            

            <code class="ruby">          add_link_as_child(doc, node, href, &#39;text/html&#39;, &#39;enclosure&#39;, short_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="124">
            <span class="hits">876</span>
            

            

            <code class="ruby">        if provider_osdd_link.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="125">
            <span class="hits">14</span>
            

            

            <code class="ruby">          link_title = &#39;Non-CMR OpenSearch Provider Granule Open Search Descriptor Document&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="126">
            <span class="hits">14</span>
            

            

            <code class="ruby">          add_link_as_child(doc, node, provider_osdd_link, &#39;application/opensearchdescription+xml&#39;, NEW_REL_MAPPING[:search], link_title)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="862" data-linenumber="128">
            <span class="hits">862</span>
            

            

            <code class="ruby">          if has_granules</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="150" data-linenumber="129">
            <span class="hits">150</span>
            

            

            <code class="ruby">            add_link_as_child(doc, node, &quot;#{ENV[&#39;opensearch_url&#39;]}/granules.atom?clientId=#{params[:clientId]}&amp;shortName=#{short_name}&amp;versionId=#{version_id}&amp;dataCenter=#{data_center}&quot;, &#39;application/atom+xml&#39;, NEW_REL_MAPPING[:search], &#39;Search for granules&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="862" data-linenumber="131">
            <span class="hits">862</span>
            

            

            <code class="ruby">          if create_cwic_osdd_link || has_granules</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="132">
            <span class="hits">225</span>
            

            

            <code class="ruby">            link_title = &quot;Granule OpenSearch Descriptor Document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="133">
            <span class="hits">225</span>
            

            

            <code class="ruby">            if Flipper.enabled?(:use_cwic_server)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="134">
            <span class="hits">36</span>
            

            

            <code class="ruby">              href_link = &quot;#{Rails.configuration.cwic_granules_osdd_endpoint}opensearch/datasets/#{id}/osdd.xml&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="135">
            <span class="hits">36</span>
            

            

            <code class="ruby">              href_link = href_link + &quot;?clientId=#{params[:clientId]}&quot; unless params[:clientId].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="136">
            <span class="hits">36</span>
            

            

            <code class="ruby">              add_link_as_child(doc, node, href_link, &#39;application/opensearchdescription+xml&#39;, NEW_REL_MAPPING[:search], link_title)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="138">
            <span class="hits">189</span>
            

            

            <code class="ruby">              href_link = &quot;#{ENV[&#39;opensearch_url&#39;]}/granules/descriptor_document.xml?collectionConceptId=#{id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="139">
            <span class="hits">189</span>
            

            

            <code class="ruby">              href_link = href_link + &quot;&amp;clientId=#{params[:clientId]}&quot; unless params[:clientId].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="140">
            <span class="hits">189</span>
            

            

            <code class="ruby">              add_link_as_child(doc, node, href_link, &#39;application/opensearchdescription+xml&#39;, NEW_REL_MAPPING[:search], link_title)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="145">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_link_as_child(doc, node, &quot;#{ENV[&#39;public_catalog_rest_endpoint&#39;]}concepts/#{guid}.xml&quot;, &#39;application/xml&#39;, &#39;via&#39;, &#39;Product metadata&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="147">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_dc_identifier(doc, id, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="148">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_dc_temporal_extent(doc, node, start_time, end_time) unless start_time.nil? and end_time.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">        # Add non-atom element array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="150">
            <span class="hits">876</span>
            

            

            <code class="ruby">        non_atom.each do |element|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10788" data-linenumber="151">
            <span class="hits">10788</span>
            

            

            <code class="ruby">          node.add_child(element)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="153">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_geoss(doc, node) if is_geoss</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="154">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_ceos(doc, node) if is_ceos</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="155">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_eosdis(doc, node) if is_eosdis</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="156">
            <span class="hits">876</span>
            

            

            <code class="ruby">        add_fedeo(doc, node) if is_fedeo</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="157">
            <span class="hits">876</span>
            

            

            <code class="ruby">        node.add_child(mbr) unless mbr.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">    # Remove all difId, onlineAccessFlag and browseFlag</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="162">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//foo:difId&#39;, &#39;foo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="163">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//foo:onlineAccessFlag&#39;, &#39;foo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="164">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//foo:browseFlag&#39;, &#39;foo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="165">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//time:start&#39;, &#39;time&#39; =&gt; &#39;http://a9.com/-/opensearch/extensions/time/1.0/&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="166">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//time:end&#39;, &#39;time&#39; =&gt; &#39;http://a9.com/-/opensearch/extensions/time/1.0/&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="167">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//foo:originalFormat&#39;, &#39;foo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="168">
            <span class="hits">189</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//foo:hasGranules&#39;, &#39;foo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove if for_atom == true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="169">
            <span class="hits">189</span>
            

            

            <code class="ruby">    raw_string = doc.to_xml</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="170">
            <span class="hits">189</span>
            

            

            <code class="ruby">    opensearch_doc = Nokogiri::XML(raw_string) do |config|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="171">
            <span class="hits">189</span>
            

            

            <code class="ruby">      config.default_xml.noblanks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="173">
            <span class="hits">189</span>
            

            

            <code class="ruby">    return opensearch_doc</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">  # a cwic dataset exists and results in a creation of a CWIC OSDD link in the OpenSearch response if the dataset is</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby">  # tagged with namespace = &#39;org.ceos.wgiss.cwic.granules&#39; | value = &#39;prod&#39; OR the Cwic-User = test request header is</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            
            

            

            <code class="ruby">  # present and dataset is tagged with namespace = &#39;org.ceos.wgiss.cwic.granules&#39; | value = &#39;test&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="179">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def cwic_collection?(entry_node, cwic_testing)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="180">
            <span class="hits">181</span>
            

            

            <code class="ruby">    has_prod_cwic = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="181">
            <span class="hits">181</span>
            

            

            <code class="ruby">    if entry_node.name == &#39;tag&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="182">
            <span class="hits">181</span>
            

            

            <code class="ruby">      value = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="183">
            <span class="hits">181</span>
            

            

            <code class="ruby">      entry_node.children.each do |tag_node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="479" data-linenumber="184">
            <span class="hits">479</span>
            

            

            <code class="ruby">        value = tag_node.content if tag_node.name == &#39;tagKey&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="186">
            <span class="hits">181</span>
            

            

            <code class="ruby">      if (value == &#39;org.ceos.wgiss.cwic.granules.prod&#39; || (value == &#39;org.ceos.wgiss.cwic.granules.test&#39; &amp;&amp; cwic_testing))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="86" data-linenumber="187">
            <span class="hits">86</span>
            

            

            <code class="ruby">        has_prod_cwic = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="190">
            <span class="hits">181</span>
            

            

            <code class="ruby">    has_prod_cwic</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">  # a provider granule OSDD collection results in the creation of a provider specific granule OSDD link if the dataset</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            
            

            

            <code class="ruby">  # is tagged with the namespace &#39;opensearch.granule.osdd&#39;.  The OSDD link is retrieved from the tag data value, which</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby">  # represents the collection level, granule specific OSDD</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="196">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def provider_granule_osdd_collection_link(entry_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28398" data-linenumber="197">
            <span class="hits">28398</span>
            

            

            <code class="ruby">    granule_specific_osdd = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28398" data-linenumber="198">
            <span class="hits">28398</span>
            

            

            <code class="ruby">    if entry_node.name == &#39;tag&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="199">
            <span class="hits">243</span>
            

            

            <code class="ruby">      tag_key = entry_node.at_xpath(&#39;echo:tagKey&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="200">
            <span class="hits">243</span>
            

            

            <code class="ruby">      tag_data = entry_node.at_xpath(&#39;echo:data&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="201">
            <span class="hits">243</span>
            

            

            <code class="ruby">      if (tag_key != nil) &amp;&amp; (tag_key.text == Rails.configuration.granule_osdd_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="202">
            <span class="hits">14</span>
            

            

            <code class="ruby">        if tag_data != nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            
            

            

            <code class="ruby">          # sample node is: &lt;echo:data&gt;&quot;http://cwictest.wgiss.ceos.org/opensearch/datasets/C1239566345-EUMETSAT/osdd.xml?clientId=rspec13&quot;&lt;/echo:data&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="204">
            <span class="hits">14</span>
            

            

            <code class="ruby">          granule_specific_osdd = tag_data.text.delete(&#39;&quot;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28398" data-linenumber="208">
            <span class="hits">28398</span>
            

            

            <code class="ruby">    granule_specific_osdd</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            
            

            

            <code class="ruby">  # a geoss collection exists and results in a creation of a echo:is_geoss element with value &#39;true&#39; if the collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby">  # is tagged with namespace = &#39;org.geo.geoss_data-core&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="213">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def geoss_collection?(entry_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="214">
            <span class="hits">225</span>
            

            

            <code class="ruby">    is_geoss = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="215">
            <span class="hits">225</span>
            

            

            <code class="ruby">    if entry_node.name == &#39;tag&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="216">
            <span class="hits">225</span>
            

            

            <code class="ruby">      value = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="217">
            <span class="hits">225</span>
            

            

            <code class="ruby">      entry_node.children.each do |tag_node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="667" data-linenumber="218">
            <span class="hits">667</span>
            

            

            <code class="ruby">        value = tag_node.content if tag_node.name == &#39;tagKey&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="220">
            <span class="hits">225</span>
            

            

            <code class="ruby">      if (value == Rails.configuration.geoss_data_core_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="221">
            <span class="hits">22</span>
            

            

            <code class="ruby">        is_geoss = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="225" data-linenumber="224">
            <span class="hits">225</span>
            

            

            <code class="ruby">    is_geoss</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby">  # a CEOS collection exists and results in a creation of a echo:is_ceos element with value &#39;true&#39; if the collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby">  # belongs to a CEOS data center or a CEOS achive center. The CEOS data centers or archive centers lists are maintained</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            
            

            

            <code class="ruby">  # in the CMR OpenSearch environment specific application configuration.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="230">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def ceos_collection?(entry_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="231">
            <span class="hits">876</span>
            

            

            <code class="ruby">    is_ceos = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="232">
            <span class="hits">876</span>
            

            

            <code class="ruby">    data_center = entry_node.at_xpath(&#39;echo:dataCenter&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="233">
            <span class="hits">876</span>
            

            

            <code class="ruby">    archive_center = entry_node.at_xpath(&#39;echo:archiveCenter&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="234">
            <span class="hits">876</span>
            

            

            <code class="ruby">    organizations = entry_node.xpath(&#39;echo:organization&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="235">
            <span class="hits">876</span>
            

            

            <code class="ruby">    if (cmr_params != nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="861" data-linenumber="236">
            <span class="hits">861</span>
            

            

            <code class="ruby">      if ((!data_center.nil? &amp;&amp; cmr_params[:data_center] != nil &amp;&amp; ceos_configured_collection?(cmr_params[:data_center],data_center.text)) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            
            

            

            <code class="ruby">          (!archive_center.nil? &amp;&amp; cmr_params[:data_center] != nil &amp;&amp; ceos_configured_collection?(cmr_params[:data_center], archive_center.text)))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="238">
            <span class="hits">4</span>
            

            

            <code class="ruby">        is_ceos = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="861" data-linenumber="240">
            <span class="hits">861</span>
            

            

            <code class="ruby">      if !is_ceos &amp;&amp; organizations.size &gt;= 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="216" data-linenumber="241">
            <span class="hits">216</span>
            

            

            <code class="ruby">        organizations.each do |organization|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="249" data-linenumber="242">
            <span class="hits">249</span>
            

            

            <code class="ruby">          if (!organization.text.blank?  &amp;&amp; cmr_params[:data_center] != nil &amp;&amp; ceos_configured_collection?(cmr_params[:data_center], organization.text))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="243">
            <span class="hits">6</span>
            

            

            <code class="ruby">            is_ceos = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="244">
            <span class="hits">6</span>
            

            

            <code class="ruby">            break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="876" data-linenumber="249">
            <span class="hits">876</span>
            

            

            <code class="ruby">    is_ceos</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            
            

            

            <code class="ruby">  # an EOSDIS collection exists and results in a creation of a echo:is_esdis element with value &#39;true&#39; if the collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            
            

            

            <code class="ruby">  # is tagged with the appropriate namespace (TBD / configurable)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="254">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def eosdis_collection?(entry_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="255">
            <span class="hits">242</span>
            

            

            <code class="ruby">    is_eosdis = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="256">
            <span class="hits">242</span>
            

            

            <code class="ruby">    if entry_node.name == &#39;tag&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="257">
            <span class="hits">242</span>
            

            

            <code class="ruby">      value = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="258">
            <span class="hits">242</span>
            

            

            <code class="ruby">      entry_node.children.each do |tag_node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="688" data-linenumber="259">
            <span class="hits">688</span>
            

            

            <code class="ruby">        value = tag_node.content if tag_node.name == &#39;tagKey&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="261">
            <span class="hits">242</span>
            

            

            <code class="ruby">      if (value == Rails.configuration.eosdis_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="262">
            <span class="hits">21</span>
            

            

            <code class="ruby">        is_eosdis = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="265">
            <span class="hits">242</span>
            

            

            <code class="ruby">    is_eosdis</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            
            

            

            <code class="ruby">  # a FedEO collection exists and results in a creation of a echo:is_fedeo element with value &#39;true&#39; if the collection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            
            

            

            <code class="ruby">  # is tagged with the appropriate namespace &#39;int.esa.fedeo&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="270">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def fedeo_collection?(entry_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="271">
            <span class="hits">242</span>
            

            

            <code class="ruby">    is_fedeo = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="272">
            <span class="hits">242</span>
            

            

            <code class="ruby">    if entry_node.name == &#39;tag&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="273">
            <span class="hits">242</span>
            

            

            <code class="ruby">      value = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="274">
            <span class="hits">242</span>
            

            

            <code class="ruby">      entry_node.children.each do |tag_node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="689" data-linenumber="275">
            <span class="hits">689</span>
            

            

            <code class="ruby">        value = tag_node.content if tag_node.name == &#39;tagKey&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="277">
            <span class="hits">242</span>
            

            

            <code class="ruby">      if (value == Rails.configuration.fedeo_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="278">
            <span class="hits">1</span>
            

            

            <code class="ruby">        is_fedeo = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="281">
            <span class="hits">242</span>
            

            

            <code class="ruby">    is_fedeo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            
            

            

            <code class="ruby">  # There is a reason we don&#39;t simplify this by using xpath. It is really slow over large result sets. Slow enough to generate user complaints.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="285">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_collection_summary(data_center, doc, entry, short_name, version_id, description = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="286">
            
            

            

            <code class="ruby">    summary = &quot;&lt;p&gt;&lt;b&gt;Short Name: &lt;/b&gt;#{short_name} &lt;b&gt;Version ID: &lt;/b&gt;#{version_id} &lt;b&gt;Data Center: &lt;/b&gt;#{data_center}&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="287">
            
            

            

            <code class="ruby">    description = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="288">
            
            

            

            <code class="ruby">    entry.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="289">
            
            

            

            <code class="ruby">      description = node.content if node.name == &#39;summary&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="291">
            
            

            

            <code class="ruby">    summary += &quot;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt;&lt;/p&gt;&lt;p&gt;#{description}&lt;/p&gt;&quot; unless description.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="292">
            
            

            

            <code class="ruby">    summary_element = add_common_summary(doc, entry, summary)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="293">
            
            

            

            <code class="ruby">    entry.add_child(summary_element)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="296">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_cmr_collection_params params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="297">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="298">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:keyword] = params[:keyword] unless params[:keyword].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="299">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:campaign] = params[:campaign] unless params[:campaign].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="300">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:sensor] = params[:sensor] unless params[:sensor].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="301">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:processing_level] = params[:processingLevel] unless params[:processingLevel].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="302">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:echo_collection_id] = params[:uid] unless params[:uid].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="303">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:include_facets] = params[:include_facets] unless params[:include_facets].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="304">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:has_granules] = params[:hasGranules] unless params[:hasGranules].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="305">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:provider] = params[:provider] unless params[:provider].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            
            

            

            <code class="ruby">    # We need this additional information to determine whether to create a granule level OSDD or not</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="308">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:include_has_granules] = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="309">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:include_tags] = &quot;#{Rails.configuration.cwic_tag},#{Rails.configuration.granule_osdd_tag},#{Rails.configuration.geoss_data_core_tag},#{Rails.configuration.eosdis_tag},#{Rails.configuration.fedeo_tag}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="310">
            <span class="hits">187</span>
            

            

            <code class="ruby">    tag_keys = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            
            

            

            <code class="ruby">    # only match CWIC collections if search parameter is present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="312">
            <span class="hits">187</span>
            

            

            <code class="ruby">    tag_keys = &#39;org.ceos.wgiss.cwic.granules.prod&#39; if params[:isCwic] &amp;&amp; params[:isCwic] == &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            
            

            

            <code class="ruby">    # only match GEOSS collections if search parameter is present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="314">
            <span class="hits">187</span>
            

            

            <code class="ruby">    if params[:isGeoss] &amp;&amp; params[:isGeoss] == &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="315">
            <span class="hits">2</span>
            

            

            <code class="ruby">      tag_keys.concat(&#39;,&#39;) unless tag_keys.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="316">
            <span class="hits">2</span>
            

            

            <code class="ruby">      tag_keys.concat(Rails.configuration.geoss_data_core_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            
            

            

            <code class="ruby">    # only match EOSDIS collections if search parameter is present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="319">
            <span class="hits">187</span>
            

            

            <code class="ruby">    if params[:isEosdis] &amp;&amp; params[:isEosdis] == &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="320">
            
            

            

            <code class="ruby">      tag_keys.concat(&#39;,&#39;) unless tag_keys.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="321">
            
            

            

            <code class="ruby">      tag_keys.concat(Rails.configuration.eosdis_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            
            

            

            <code class="ruby">    # only match FedEO collections if search parameter is present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="324">
            <span class="hits">187</span>
            

            

            <code class="ruby">    if params[:isFedeo] &amp;&amp; params[:isFedeo] == &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="325">
            
            

            

            <code class="ruby">      tag_keys.concat(&#39;,&#39;) unless tag_keys.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="326">
            
            

            

            <code class="ruby">      tag_keys.concat(Rails.configuration.fedeo_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="329">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params[:tag_key] = tag_keys unless tag_keys.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="331">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_params = to_cmr_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="332">
            <span class="hits">187</span>
            

            

            <code class="ruby">    if params[:isCeos] &amp;&amp; params[:isCeos] == &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="333">
            <span class="hits">1</span>
            

            

            <code class="ruby">      ceoss_agencies_collections_cmr_params = CeosAgency.create_all_ceos_agencies_cmr_query_string(Rails.configuration.ceos_agencies)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="334">
            <span class="hits">1</span>
            

            

            <code class="ruby">      cmr_params.merge! ceoss_agencies_collections_cmr_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="337">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params.merge! cmr_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="338">
            <span class="hits">187</span>
            

            

            <code class="ruby">    cmr_collection_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="341">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_geoss(doc, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="342">
            <span class="hits">22</span>
            

            

            <code class="ruby">    geoss_node = Nokogiri::XML::Node.new &#39;echo:is_geoss&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="343">
            <span class="hits">22</span>
            

            

            <code class="ruby">    geoss_node.content = &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="344">
            <span class="hits">22</span>
            

            

            <code class="ruby">    node.add_child(geoss_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="345">
            <span class="hits">22</span>
            

            

            <code class="ruby">    node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="348">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_ceos(doc, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="349">
            <span class="hits">10</span>
            

            

            <code class="ruby">    ceos_node = Nokogiri::XML::Node.new &#39;echo:is_ceos&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="350">
            <span class="hits">10</span>
            

            

            <code class="ruby">    ceos_node.content = &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="351">
            <span class="hits">10</span>
            

            

            <code class="ruby">    node.add_child(ceos_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="352">
            <span class="hits">10</span>
            

            

            <code class="ruby">    node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="355">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_eosdis(doc, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="356">
            <span class="hits">21</span>
            

            

            <code class="ruby">    eosdis_node = Nokogiri::XML::Node.new &#39;echo:is_eosdis&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="357">
            <span class="hits">21</span>
            

            

            <code class="ruby">    eosdis_node.content = &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="358">
            <span class="hits">21</span>
            

            

            <code class="ruby">    node.add_child(eosdis_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="359">
            <span class="hits">21</span>
            

            

            <code class="ruby">    node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="361">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="362">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_fedeo(doc, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="363">
            <span class="hits">1</span>
            

            

            <code class="ruby">    fedeo_node = Nokogiri::XML::Node.new &#39;echo:is_fedeo&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="364">
            <span class="hits">1</span>
            

            

            <code class="ruby">    fedeo_node.content = &#39;true&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="365">
            <span class="hits">1</span>
            

            

            <code class="ruby">    node.add_child(fedeo_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="366">
            <span class="hits">1</span>
            

            

            <code class="ruby">    node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="370">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def ceos_configured_collection?(ceos_collections_array_with_wildcard, collection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="371">
            <span class="hits">28</span>
            

            

            <code class="ruby">    ret_val = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="372">
            <span class="hits">28</span>
            

            

            <code class="ruby">    ceos_collections_array_with_wildcard.each do |ceos_configured_collection|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="660" data-linenumber="373">
            <span class="hits">660</span>
            

            

            <code class="ruby">      if collection.match(ceos_configured_collection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="374">
            <span class="hits">10</span>
            

            

            <code class="ruby">        ret_val = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="375">
            <span class="hits">10</span>
            

            

            <code class="ruby">        break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="378">
            <span class="hits">28</span>
            

            

            <code class="ruby">    ret_val</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="679c26bbf019d43978941e2d8e97f9f8e024f80b">
  <div class="header">
    <h3>app/models/facet.rb</h3>
    <h4>
      <span class="green">
  96.88%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>64</b> relevant lines.
      <span class="green"><b>62</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class Facet</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby">  # At the moment we only support searching by some of the supported facets. When we add additional search parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby">  # we can uncomment the additional facets below</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  FACET_MAPPING = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby">      &#39;platform&#39; =&gt; &#39;Satellite&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">      &#39;instrument&#39; =&gt; &#39;Instrument&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">      &#39;project&#39; =&gt; &#39;Campaign&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby">      &#39;sensor&#39; =&gt; &#39;Sensor&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">      &#39;processing_level_id&#39; =&gt; &#39;Processing Level&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">      # &#39;two_d_coordinate_system_name&#39; =&gt; &#39;Two Dimensional Coordinate Name&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">      # &#39;category&#39; =&gt; &#39;Category Keyword&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">      # &#39;topic&#39; =&gt; &#39;Topic Keyword&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">      # &#39;term&#39; =&gt; &#39;Term Keyword&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">      # &#39;variable_level_1&#39; =&gt;&#39;Variable Level 1 Keyword&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">      # &#39;variable_level_2&#39; =&gt;&#39;Variable Level 2 Keyword&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">      # &#39;variable_level_3&#39; =&gt;&#39;Variable Level 3 Keyword&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">      # &#39;detailed_variable&#39; =&gt;&#39;Detailed Variable&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="20">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.extract_facet_params params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="21">
            <span class="hits">185</span>
            

            

            <code class="ruby">    facet_params = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="22">
            <span class="hits">185</span>
            

            

            <code class="ruby">    facet_params[:facet_limit] = params[:facetLimit] unless params[:facetLimit].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="23">
            <span class="hits">185</span>
            

            

            <code class="ruby">    facet_params[:facet_start] = params[:facetStart] unless params[:facetStart].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="24">
            <span class="hits">185</span>
            

            

            <code class="ruby">    facet_params[:facet_sort] = params[:facetSort] unless params[:facetSort].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="25">
            <span class="hits">185</span>
            

            

            <code class="ruby">    facet_params[:facet_count] = params[:facetCount] unless params[:facetCount].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="26">
            <span class="hits">185</span>
            

            

            <code class="ruby">    facet_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="29">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.whole_list?(params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">    !params[:facet_limit].blank? and params[:facet_limit] == &#39;-1&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.process_facet_search(collections, facet_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="34">
            <span class="hits">9</span>
            

            

            <code class="ruby">    cmr_facets = collections.xpath(&#39;//echo:facets&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="35">
            <span class="hits">9</span>
            

            

            <code class="ruby">    opensearch_facets, facet_count = to_opensearch_facets(cmr_facets)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">    # for now we only support the facetLimit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="37">
            <span class="hits">9</span>
            

            

            <code class="ruby">    if (facet_params[:facet_limit].to_i &gt; 0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">      # enforce a non zero positive limit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="39">
            <span class="hits">2</span>
            

            

            <code class="ruby">      processed_facet_response = enforce_positive_facet_limit(opensearch_facets, facet_params[:facet_limit].to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="41">
            <span class="hits">7</span>
            

            

            <code class="ruby">      processed_facet_response = opensearch_facets</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">    # remove cmr facets and replace with sru facets</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="44">
            <span class="hits">9</span>
            

            

            <code class="ruby">    cmr_facets.remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="45">
            <span class="hits">9</span>
            

            

            <code class="ruby">    collections.root.add_child(processed_facet_response) unless processed_facet_response.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="46">
            <span class="hits">9</span>
            

            

            <code class="ruby">    return processed_facet_response, facet_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">  # the positive facet limit is used to enforce the maximum number of counts reported per facet field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">  # for each field, reduce amount to 100 and reduce individual actualTerm counts by the same pecentage as the field (aggregate)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="52">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.enforce_positive_facet_limit(opensearch_original_facet_response, positive_facet_limit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="53">
            <span class="hits">2</span>
            

            

            <code class="ruby">    global_facet_limit_response = opensearch_original_facet_response</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="54">
            <span class="hits">2</span>
            

            

            <code class="ruby">    facet_nodes = opensearch_original_facet_response.xpath(&#39;.//sru:facets/sru:facet&#39;, &#39;sru&#39; =&gt; &#39;http://docs.oasis-open.org/ns/search-ws/facetedResults&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="55">
            <span class="hits">2</span>
            

            

            <code class="ruby">    facet_nodes.each do |facet|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">      # we traverse each facet because we&#39;ll also have to support individual facet limits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="57">
            <span class="hits">10</span>
            

            

            <code class="ruby">      facet_term_count_nodes = facet.xpath(&#39;.//sru:terms/sru:term/sru:count&#39;, &#39;sru&#39; =&gt; &#39;http://docs.oasis-open.org/ns/search-ws/facetedResults&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="58">
            <span class="hits">10</span>
            

            

            <code class="ruby">      facet_term_count_nodes.each do |count|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4608" data-linenumber="59">
            <span class="hits">4608</span>
            

            

            <code class="ruby">        if (count.content.to_i &gt; positive_facet_limit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110" data-linenumber="60">
            <span class="hits">110</span>
            

            

            <code class="ruby">          count.content=(positive_facet_limit.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="64">
            <span class="hits">2</span>
            

            

            <code class="ruby">    return global_facet_limit_response</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby">  # processing for ALL supported request facet parameters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="68">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.processing_required(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="69">
            <span class="hits">185</span>
            

            

            <code class="ruby">    processing_required = false;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="70">
            <span class="hits">185</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;Facet parameters: #{params.inspect}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="71">
            <span class="hits">185</span>
            

            

            <code class="ruby">    facet_limit = params[:facet_limit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="185" data-linenumber="72">
            <span class="hits">185</span>
            

            

            <code class="ruby">    if !facet_limit.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="73">
            <span class="hits">10</span>
            

            

            <code class="ruby">      case facet_limit.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">        when Integer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="75">
            <span class="hits">10</span>
            

            

            <code class="ruby">          case facet_limit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">            when &#39;0&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            <span class="hits">1</span>
            

            

            <code class="ruby">              Rails.logger.info &quot;Facet processing not requested due to faceLimit value: #{facet_limit}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">            when &#39;-1&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">              # stop processing ALL other facet parameters and present ALL facets matching the query string</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="80">
            <span class="hits">7</span>
            

            

            <code class="ruby">              processing_required = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="81">
            <span class="hits">7</span>
            

            

            <code class="ruby">              Rails.logger.info &quot;All facet values will be returned and all other facet parameter values discarded due to facetLimit value: #{facet_limit}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">              # remove ALL other params except for facetLimit = -1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="83">
            <span class="hits">7</span>
            

            

            <code class="ruby">              params.replace({:facet_limit =&gt; &#39;-1&#39;})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="84">
            <span class="hits">7</span>
            

            

            <code class="ruby">              return [processing_required]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="86">
            <span class="hits">2</span>
            

            

            <code class="ruby">              processing_required = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="87">
            <span class="hits">2</span>
            

            

            <code class="ruby">              Rails.logger.info &quot;Result set processing required due to facetLimit value: #{facet_limit}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">          Rails.logger.info &quot;Unsupported faceLimit value: #{facet_limit}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="175" data-linenumber="93">
            <span class="hits">175</span>
            

            

            <code class="ruby">      Rails.logger.info &quot;None of the specified facet search parameters: #{params.inspect} are supported in the current implementation&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="95">
            <span class="hits">178</span>
            

            

            <code class="ruby">    return processing_required</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="98">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.to_opensearch_facets(cmr_response_facet_xml)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="99">
            <span class="hits">9</span>
            

            

            <code class="ruby">    facets = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="100">
            <span class="hits">9</span>
            

            

            <code class="ruby">    facet_count = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="101">
            <span class="hits">9</span>
            

            

            <code class="ruby">    cmr_response_facet_xml.children.each do |facet|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="102">
            <span class="hits">127</span>
            

            

            <code class="ruby">      real_name = facet[&#39;field&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="103">
            <span class="hits">127</span>
            

            

            <code class="ruby">      display_name = FACET_MAPPING[&quot;#{real_name}&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="104">
            <span class="hits">127</span>
            

            

            <code class="ruby">      unless display_name.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="105">
            <span class="hits">45</span>
            

            

            <code class="ruby">        terms = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="106">
            <span class="hits">45</span>
            

            

            <code class="ruby">        facet.children.each do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">          #unless t.name == &#39;text&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11338" data-linenumber="108">
            <span class="hits">11338</span>
            

            

            <code class="ruby">            term = &lt;&lt;-eos</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">                         &lt;sru:term&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">                           &lt;sru:actualTerm&gt;#{t.text}&lt;/sru:actualTerm&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">                           &lt;sru:count&gt;#{t[&#39;count&#39;]}&lt;/sru:count&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">                         &lt;/sru:term&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">            eos</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11338" data-linenumber="114">
            <span class="hits">11338</span>
            

            

            <code class="ruby">            terms &lt;&lt; term</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">          #end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">        #unless facet.name == &#39;text&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="118">
            <span class="hits">45</span>
            

            

            <code class="ruby">          f = &lt;&lt;-eos</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">                    &lt;sru:facet&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby">                      &lt;sru:facetDisplayLabel&gt;#{display_name}&lt;/sru:facetDisplayLabel&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">                    	&lt;sru:index&gt;#{real_name}&lt;/sru:index&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            
            

            

            <code class="ruby">                    	&lt;sru:relation&gt;=&lt;/sru:relation&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">                      &lt;sru:terms&gt;#{terms}&lt;/sru:terms&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">                    &lt;/sru:facet&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            
            

            

            <code class="ruby">          eos</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="126">
            <span class="hits">45</span>
            

            

            <code class="ruby">          facets &lt;&lt; f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="127">
            <span class="hits">45</span>
            

            

            <code class="ruby">          facet_count = facet_count + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">        #end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="132">
            <span class="hits">9</span>
            

            

            <code class="ruby">    os_facet_string = &lt;&lt;-eos</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">      &lt;sru:facetedResults xsi:schemaLocation=&quot;http://docs.oasis-open.org/ns/search-ws/facetedResults facetedResults.xsd&quot; xmlns:sru=&quot;http://docs.oasis-open.org/ns/search-ws/facetedResults&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">      	&lt;sru:datasource&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">      		&lt;sru:datasourceDisplayLabel&gt;CMR REST API&lt;/sru:datasourceDisplayLabel&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">      		&lt;sru:datasourceDescription&gt;CMR catalog holdings exposed via the CMR REST API&lt;/sru:datasourceDescription&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">      		&lt;sru:baseURL&gt;https://earthdata.nasa.gov/echo&lt;/sru:baseURL&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">      		&lt;sru:facets&gt;#{facets}&lt;/sru:facets&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby">        &lt;/sru:datasource&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            
            

            

            <code class="ruby">      &lt;/sru:facetedResults</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">    eos</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">    # format the fragment since it will not be formatted when added to the atom feed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="143">
            <span class="hits">9</span>
            

            

            <code class="ruby">    os_facet_doc = Nokogiri::XML(os_facet_string) do |config|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="144">
            <span class="hits">9</span>
            

            

            <code class="ruby">      config.default_xml.noblanks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="146">
            <span class="hits">9</span>
            

            

            <code class="ruby">    return Nokogiri::XML::DocumentFragment.parse(os_facet_doc.root), facet_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a6b2b9901d99d2c7271170fbbb0504d2b227975c">
  <div class="header">
    <h3>app/models/granule.rb</h3>
    <h4>
      <span class="green">
  94.31%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>123</b> relevant lines.
      <span class="green"><b>116</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">class Granule &lt; Metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby">  # this is the collection conceptId</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :parentIdentifier</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="5">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :parent_identifier :parentIdentifier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">  # this indicates whether or not the granule search is the result of a the search form submission</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :invokedFromSearchForm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="9">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validate :form_submission_required_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def find(params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="12">
            <span class="hits">93</span>
            

            

            <code class="ruby">    cmr_params = to_cmr_granule_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="13">
            <span class="hits">93</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;CMR Params: #{cmr_params}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="14">
            <span class="hits">93</span>
            

            

            <code class="ruby">    response = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="15">
            <span class="hits">93</span>
            

            

            <code class="ruby">    query_url = &quot;#{ENV[&#39;catalog_rest_endpoint&#39;]}granules.atom&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="16">
            <span class="hits">93</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;RestClient call to CMR endpoint: #{query_url}?#{cmr_params.to_query}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="17">
            <span class="hits">93</span>
            

            

            <code class="ruby">    time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="18">
            <span class="hits">93</span>
            

            

            <code class="ruby">      response = RestClient::Request.execute :method =&gt; :get, :url =&gt; query_url, :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE, :headers =&gt; {:client_id =&gt; CLIENT_ID, :params =&gt; cmr_params}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="20">
            <span class="hits">91</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;CMR granule search took #{(time.to_f * 1000).round(0)} ms&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="21">
            <span class="hits">91</span>
            

            

            <code class="ruby">    hits = response.headers[:cmr_hits] ? response.headers[:cmr_hits].to_i : 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="22">
            <span class="hits">91</span>
            

            

            <code class="ruby">    results = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="23">
            <span class="hits">91</span>
            

            

            <code class="ruby">    elapsed_time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">      # ruby plus nokogiri do not let us overwrite namespace hrefs so we have to do it at the string level</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="25">
            <span class="hits">91</span>
            

            

            <code class="ruby">      doc_as_string = fix_geo_href(response)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="26">
            <span class="hits">91</span>
            

            

            <code class="ruby">      results = to_open_search_granules(Nokogiri::XML(doc_as_string), hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="28">
            <span class="hits">91</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;Open Search translation took : #{(elapsed_time.to_f * 1000).round(0)} ms&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="29">
            <span class="hits">91</span>
            

            

            <code class="ruby">    results</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">  # There is a reason we don&#39;t simplify this by using xpath. It is really slow over large result sets. Slow enough to generate user complaints.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_open_search_granules(doc, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="34">
            <span class="hits">98</span>
            

            

            <code class="ruby">    doc, subtitle_node = to_open_search_common(doc, hits, params, &#39;granule&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="35">
            <span class="hits">98</span>
            

            

            <code class="ruby">    add_nav_links(doc, subtitle_node, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="36">
            <span class="hits">98</span>
            

            

            <code class="ruby">    add_esipbp_uplink(doc, subtitle_node, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="37">
            <span class="hits">98</span>
            

            

            <code class="ruby">    doc.root.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1980" data-linenumber="38">
            <span class="hits">1980</span>
            

            

            <code class="ruby">      if node.name == &#39;entry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="39">
            <span class="hits">261</span>
            

            

            <code class="ruby">        id_node, last_link, start_time, end_time, mbr = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="40">
            <span class="hits">261</span>
            

            

            <code class="ruby">        non_atom = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">        # if/elsif is faster than case.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="42">
            <span class="hits">261</span>
            

            

            <code class="ruby">        node.children.each do |sub_node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5840" data-linenumber="43">
            <span class="hits">5840</span>
            

            

            <code class="ruby">          if sub_node.name == &#39;title&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="44">
            <span class="hits">261</span>
            

            

            <code class="ruby">            sub_node[:type] = &#39;text&#39; if sub_node.element?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5579" data-linenumber="45">
            <span class="hits">5579</span>
            

            

            <code class="ruby">          elsif sub_node.name == &#39;link&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">            # resolve the ambiguous CMR #data ( OpenSearch enclosure) links which in some cases result in more than one</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">            # enclosure link but only one valid link for the actual data retrieval</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1078" data-linenumber="48">
            <span class="hits">1078</span>
            

            

            <code class="ruby">            if sub_node[&#39;rel&#39;].end_with?(&#39;/data#&#39;) &amp;&amp; sub_node.at_xpath(&#39;echo:inherited&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">              # the &#39;GET DATA&#39; link should bot be there in the first place, it is inherited from the collection and does</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby">              # not allow direct access to the granule data file</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="209" data-linenumber="51">
            <span class="hits">209</span>
            

            

            <code class="ruby">              sub_node.remove</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">            else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="53">
            <span class="hits">869</span>
            

            

            <code class="ruby">              decorate_link(node, sub_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="54">
            <span class="hits">869</span>
            

            

            <code class="ruby">              last_link = sub_node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4501" data-linenumber="56">
            <span class="hits">4501</span>
            

            

            <code class="ruby">          elsif sub_node.name == &#39;id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="57">
            <span class="hits">261</span>
            

            

            <code class="ruby">            id_node = sub_node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4240" data-linenumber="58">
            <span class="hits">4240</span>
            

            

            <code class="ruby">          elsif sub_node.name == &#39;start&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="207" data-linenumber="59">
            <span class="hits">207</span>
            

            

            <code class="ruby">            start_time = sub_node.content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4033" data-linenumber="60">
            <span class="hits">4033</span>
            

            

            <code class="ruby">          elsif sub_node.name == &#39;end&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="206" data-linenumber="61">
            <span class="hits">206</span>
            

            

            <code class="ruby">            end_time = sub_node.content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3827" data-linenumber="62">
            <span class="hits">3827</span>
            

            

            <code class="ruby">          elsif sub_node.name == &#39;georss:polygon&#39; or sub_node.name == &#39;georss:line&#39; or sub_node.name == &#39;georss:point&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="63">
            <span class="hits">6</span>
            

            

            <code class="ruby">            mbr = generate_mbr(doc, sub_node)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5840" data-linenumber="65">
            <span class="hits">5840</span>
            

            

            <code class="ruby">          non_atom &lt;&lt; sub_node.remove if sub_node.namespace.nil? or sub_node.namespace.href != &#39;http://www.w3.org/2005/Atom&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="68">
            <span class="hits">261</span>
            

            

            <code class="ruby">        last_link = doc.root.children.last if last_link.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="69">
            <span class="hits">261</span>
            

            

            <code class="ruby">        guid = id_node.content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="70">
            <span class="hits">261</span>
            

            

            <code class="ruby">        id_node.content = &quot;#{ENV[&#39;opensearch_url&#39;]}/granules.atom?uid=#{guid}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="71">
            <span class="hits">261</span>
            

            

            <code class="ruby">        add_cmr_metadata_link(doc, last_link, node, guid)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="72">
            <span class="hits">261</span>
            

            

            <code class="ruby">        add_dc_identifier(doc, guid, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="73">
            <span class="hits">261</span>
            

            

            <code class="ruby">        add_dc_temporal_extent(doc, node, start_time, end_time) unless start_time.nil? and end_time.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby">        # Add non-atom element array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="75">
            <span class="hits">261</span>
            

            

            <code class="ruby">        non_atom.each do |element|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3979" data-linenumber="76">
            <span class="hits">3979</span>
            

            

            <code class="ruby">          node.add_child(element)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="78">
            <span class="hits">261</span>
            

            

            <code class="ruby">        node.add_child(mbr) unless mbr.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="81">
            <span class="hits">98</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//echo:onlineAccessFlag&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="82">
            <span class="hits">98</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//echo:browseFlag&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="83">
            <span class="hits">98</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//echo:dayNightFlag&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="84">
            <span class="hits">98</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//time:start&#39;, &#39;time&#39; =&gt; &#39;http://a9.com/-/opensearch/extensions/time/1.0/&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="85">
            <span class="hits">98</span>
            

            

            <code class="ruby">    doc.xpath(&#39;//time:end&#39;, &#39;time&#39; =&gt; &#39;http://a9.com/-/opensearch/extensions/time/1.0/&#39;).remove</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="86">
            <span class="hits">98</span>
            

            

            <code class="ruby">    opensearch_doc = Nokogiri::XML(doc.to_xml) do |config|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="87">
            <span class="hits">98</span>
            

            

            <code class="ruby">      config.default_xml.noblanks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="90">
            <span class="hits">98</span>
            

            

            <code class="ruby">    opensearch_doc</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="93">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_cmr_metadata_link(doc, last_link, entry, guid)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="94">
            <span class="hits">261</span>
            

            

            <code class="ruby">    link = Nokogiri::XML::Node.new &#39;link&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="95">
            <span class="hits">261</span>
            

            

            <code class="ruby">    link[:href] = &quot;#{ENV[&#39;public_catalog_rest_endpoint&#39;]}concepts/#{guid}.xml&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="96">
            <span class="hits">261</span>
            

            

            <code class="ruby">    link[:hreflang] = &#39;en-US&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="97">
            <span class="hits">261</span>
            

            

            <code class="ruby">    link[:type] = &#39;application/xml&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="98">
            <span class="hits">261</span>
            

            

            <code class="ruby">    link[:rel] = &#39;via&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="99">
            <span class="hits">261</span>
            

            

            <code class="ruby">    link = fix_rel link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="101">
            <span class="hits">261</span>
            

            

            <code class="ruby">    link[:title] = &#39;Product metadata&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">    # Add as sibling to last link element in entry</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="103">
            <span class="hits">261</span>
            

            

            <code class="ruby">    if last_link.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">      entry.add_child(link)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="106">
            <span class="hits">261</span>
            

            

            <code class="ruby">      last_link.add_next_sibling(link)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="111">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def decorate_link(node, sub_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="112">
            <span class="hits">869</span>
            

            

            <code class="ruby">    sub_node = add_type(sub_node)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">    # Replace rel if this is documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="114">
            <span class="hits">869</span>
            

            

            <code class="ruby">    sub_node = fix_rel(sub_node)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">    # Namespace inherited attribute if present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="116">
            <span class="hits">869</span>
            

            

            <code class="ruby">    sub_node = fix_inherited(sub_node) unless sub_node[:inherited].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">    #node.add_child(sub_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="869" data-linenumber="118">
            <span class="hits">869</span>
            

            

            <code class="ruby">    sub_node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  # There is a reason we don&#39;t simplify this by using xpath. It is really slow over large result sets. Slow enough to generate user complaints.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="122">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.to_html_model granules_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="123">
            <span class="hits">31</span>
            

            

            <code class="ruby">    granules = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="124">
            <span class="hits">31</span>
            

            

            <code class="ruby">    granules_document.root.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="491" data-linenumber="125">
            <span class="hits">491</span>
            

            

            <code class="ruby">      if node.name == &#39;entry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="126">
            <span class="hits">49</span>
            

            

            <code class="ruby">        granule = create_html_model(node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="127">
            <span class="hits">49</span>
            

            

            <code class="ruby">        granules &lt;&lt; granule</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="130">
            <span class="hits">31</span>
            

            

            <code class="ruby">    granules</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="133">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_granule_summary(doc, entry)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">    dataset_id = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            
            

            

            <code class="ruby">    entry.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            
            

            

            <code class="ruby">      dataset_id = node.content if node.name == &#39;datasetId&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">    summary = &quot;&lt;p&gt;&lt;b&gt;Dataset ID: &lt;/b&gt;#{dataset_id}&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">    summary_element = add_common_summary(doc, entry, summary)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">    entry.add_child(summary_element)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="143">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_cmr_granule_params params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="144">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="145">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params[:short_name] = params[:shortName] unless params[:shortName].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="146">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params[:version] = params[:versionId] unless params[:versionId].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="147">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params[:provider] = params[:dataCenter] unless params[:dataCenter].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="148">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params[:echo_granule_id] = params[:uid] unless params[:uid].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="149">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params[:dataset_id] = params[:dataset_id] unless params[:dataset_id].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="150">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params[:collection_concept_id] = params[:parentIdentifier] unless params[:parentIdentifier].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="152">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_params = to_cmr_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="153">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params.merge! cmr_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="154">
            <span class="hits">97</span>
            

            

            <code class="ruby">    cmr_granule_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="157">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def form_submission_required_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="258" data-linenumber="158">
            <span class="hits">258</span>
            

            

            <code class="ruby">    if invokedFromSearchForm &amp;&amp; uid.blank? &amp;&amp; parentIdentifier.blank? &amp;&amp; shortName.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="159">
            <span class="hits">9</span>
            

            

            <code class="ruby">      if shortName.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="160">
            <span class="hits">9</span>
            

            

            <code class="ruby">        errors.add(:shortName, &quot;: A granule search requires the Collection ConceptID or the Collection ShortName or the Granule Unique Identifier&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="162">
            <span class="hits">9</span>
            

            

            <code class="ruby">      if parentIdentifier.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="163">
            <span class="hits">9</span>
            

            

            <code class="ruby">        errors.add(:parentIdentifier, &quot;: A granule search requires the Collection ConceptID or the Collection ShortName or the Granule Unique Identifier&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="165">
            <span class="hits">9</span>
            

            

            <code class="ruby">      if uid.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="166">
            <span class="hits">9</span>
            

            

            <code class="ruby">        errors.add(:uid, &quot;: A granule search requires the Collection ConceptID or the Collection ShortName or the Granule Unique Identifier&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="172">
            <span class="hits">2</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby">  # we only need an uplink if ALL the granules in the current granule search response have the same datasetId</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="175">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_esipbp_uplink(doc, subtitle_node, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="176">
            <span class="hits">98</span>
            

            

            <code class="ruby">    up_link = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="177">
            <span class="hits">98</span>
            

            

            <code class="ruby">    dataset_ids_hash = Hash.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="178">
            <span class="hits">98</span>
            

            

            <code class="ruby">    echo_datasetid_nodes = doc.xpath(&#39;//echo:datasetId&#39;, &#39;echo&#39; =&gt; &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby">    # can only add the up link per ESIP BP spec if ALL the granules in the result have the same datasetId</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="180">
            <span class="hits">98</span>
            

            

            <code class="ruby">    echo_datasetid_nodes.each do |echo_datasetid_node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="181">
            <span class="hits">261</span>
            

            

            <code class="ruby">      dataset_ids_hash[echo_datasetid_node.text] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="183">
            <span class="hits">98</span>
            

            

            <code class="ruby">    if dataset_ids_hash.size == 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="74" data-linenumber="184">
            <span class="hits">74</span>
            

            

            <code class="ruby">      url = url.gsub(/\?.*/, &quot;?datasetId=#{dataset_ids_hash.keys[0]}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="74" data-linenumber="185">
            <span class="hits">74</span>
            

            

            <code class="ruby">      up_link = add_link_as_sibling(doc, subtitle_node, url, &#39;application/atom+xml&#39;, &#39;up&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="187">
            <span class="hits">98</span>
            

            

            <code class="ruby">    return up_link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8edf4db1cce12de14925b007de364853cdc8cfd7">
  <div class="header">
    <h3>app/models/health.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Health</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby">  # things to check: CMR search</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="5">
            <span class="hits">5</span>
            

            

            <code class="ruby">    @cmr_ok = cmr_status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def ok?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="9">
            <span class="hits">7</span>
            

            

            <code class="ruby">    @cmr_ok</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def cmr_status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="15">
            <span class="hits">5</span>
            

            

            <code class="ruby">    ok = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="16">
            <span class="hits">5</span>
            

            

            <code class="ruby">    response = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="17">
            <span class="hits">5</span>
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="18">
            <span class="hits">5</span>
            

            

            <code class="ruby">      response = RestClient::Request.execute :method =&gt; :get, :url =&gt; &quot;#{ENV[&#39;catalog_rest_endpoint&#39;]}health&quot;, :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="19">
            <span class="hits">4</span>
            

            

            <code class="ruby">      ok = response.body.include?(&quot;\&quot;ok?\&quot;:true&quot;) &amp;&amp; !response.body.include?(&#39;:false&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">    rescue</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">      ok = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="23">
            <span class="hits">5</span>
            

            

            <code class="ruby">    ok</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4d4e0816194b7247da0f1046bbec2aa1b919a750">
  <div class="header">
    <h3>app/models/metadata.rb</h3>
    <h4>
      <span class="yellow">
  87.39%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>460</b> relevant lines.
      <span class="green"><b>402</b> lines covered</span> and
      <span class="red"><b>58</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">require &#39;rgeo&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="2">
            <span class="hits">2</span>
            

            

            <code class="ruby">require &#39;geo_ruby&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">class Metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="6">
            <span class="hits">2</span>
            

            

            <code class="ruby">  CLIENT_ID = &#39;cmr-open-search&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="8">
            <span class="hits">2</span>
            

            

            <code class="ruby">  DOCUMENTATION_MIME_TYPES = %w(text/rtf text/richtext text/plain text/html text/example text/enriched text/directory text/csv text/css text/calendar application/http application/msword application/rtf application/wordperfect5.1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="9">
            <span class="hits">2</span>
            

            

            <code class="ruby">  DOCUMENTATION_EXTENSIONS = %w(rtf html csv css calendar doc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            <span class="hits">2</span>
            

            

            <code class="ruby">  NEW_REL_MAPPING = {:data =&gt; &#39;enclosure&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">                     :browse =&gt; &#39;icon&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">                     :metadata =&gt; &#39;via&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">                     :documentation =&gt; &#39;describedBy&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">                     :osdd =&gt; &#39;search&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">                     :search =&gt; &#39;search&#39;}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            <span class="hits">2</span>
            

            

            <code class="ruby">  OLD_REL_MAPPING = {:data =&gt; &#39;http://esipfed.org/ns/fedsearch/1.1/data#&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">                     :browse =&gt; &#39;http://esipfed.org/ns/fedsearch/1.1/browse#&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">                     :metadata =&gt; &#39;http://esipfed.org/ns/fedsearch/1.1/metadata#&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">                     :documentation =&gt; &#39;http://esipfed.org/ns/fedsearch/1.1/documentation#&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">                     :osdd =&gt; &#39;search&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">                     :search =&gt; &#39;http://esipfed.org/ns/fedsearch/1.0/search#&#39;}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="25">
            <span class="hits">2</span>
            

            

            <code class="ruby">  include ActiveModel::Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="26">
            <span class="hits">2</span>
            

            

            <code class="ruby">  include ActiveModel::Conversion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="27">
            <span class="hits">2</span>
            

            

            <code class="ruby">  extend ActiveModel::Naming</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="29">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :clientId, :keyword, :instrument, :satellite, :startTime, :endTime, :boundingBox, :campaign, :processingLevel, :sensor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="30">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :geometry, :numberOfResults, :cursor, :offset, :shortName, :versionId, :dataCenter, :dataset_id, :provider</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            <span class="hits">2</span>
            

            

            <code class="ruby">  attr_accessor :placeName, :uid, :lat, :lon, :radius</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :start_time :startTime</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="34">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :end_time :endTime</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="35">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :bounding_box :boundingBox</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="36">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :processing_level :processingLevel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="37">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :number_of_results :numberOfResults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="38">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :short_name :shortName</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="39">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :version_id :versionId</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="40">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :data_center :dataCenter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="41">
            <span class="hits">2</span>
            

            

            <code class="ruby">  alias :place_name :placeName</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  # numberOfResults represents the page_size (max 2000) for both page navigation and offset navigation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validates :numberOfResults, :numericality =&gt; {:only_integer =&gt; true, :greater_than =&gt; 0, :less_than =&gt; 2001}, :allow_blank =&gt; true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validates :cursor, :numericality =&gt; {:only_integer =&gt; true, :greater_than =&gt; 0}, :allow_blank =&gt; true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="46">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validates :offset, :numericality =&gt; {:only_integer =&gt; true, :greater_than_or_equal_to =&gt; 0}, :allow_blank =&gt; true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validates :clientId, :format =&gt; {:with =&gt; /\A[a-zA-Z0-9_\-]+\z/,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">                                   :message =&gt; &#39;is invalid, it must be an alpha-numeric string of length greater than or equal to 1, and may contain underscore (_) or dash (-) characters.&#39;}, :allow_blank =&gt; true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="51">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validate :temporal_must_be_rfc3339</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="52">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validate :geometry_is_point_line_polygon</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="53">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validate :bbox_is_valid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="54">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validate :point_radius_is_valid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="56">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validate :place_name_exists</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="58">
            <span class="hits">2</span>
            

            

            <code class="ruby">  validate :invalid_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="60">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def initialize(attributes = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="567" data-linenumber="61">
            <span class="hits">567</span>
            

            

            <code class="ruby">    @invalid_param_errors = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="567" data-linenumber="62">
            <span class="hits">567</span>
            

            

            <code class="ruby">    attributes.each do |name, value|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3068" data-linenumber="63">
            <span class="hits">3068</span>
            

            

            <code class="ruby">      if %w(placeName clientId keyword instrument satellite sensor processingLevel campaign startTime endTime boundingBox lat lon radius geometry placeName numberOfResults cursor offset shortName versionId dataCenter dataset_id uid hasGranules isCwic isGeoss isCeos isEosdis isFedeo parentIdentifier provider).include? name.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3061" data-linenumber="64">
            <span class="hits">3061</span>
            

            

            <code class="ruby">        send(&quot;#{name}=&quot;, value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">        # discard invalid query parameter per CEOS-BP-009B</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="67">
            <span class="hits">7</span>
            

            

            <code class="ruby">        attributes.delete(name);</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="68">
            <span class="hits">7</span>
            

            

            <code class="ruby">        Rails.logger.info(&quot;Discarded unsupported query parameter #{name}=#{value} per CEOS Best Practices 009B&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="73">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def persisted?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="77">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def invalid_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="78">
            <span class="hits">615</span>
            

            

            <code class="ruby">    @invalid_param_errors.each do |error|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">      errors.add(error[0], error[1])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="83">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def place_name_exists</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="84">
            <span class="hits">615</span>
            

            

            <code class="ruby">    unless placeName.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="85">
            <span class="hits">12</span>
            

            

            <code class="ruby">      errors.add(:placeName, &quot;#{placeName} cannot be located&quot;) if !PlaceNameToPoint.exists?(placeName)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="89">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def temporal_must_be_rfc3339</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="90">
            <span class="hits">615</span>
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="91">
            <span class="hits">615</span>
            

            

            <code class="ruby">      DateTime.rfc3339(startTime) unless startTime.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">    rescue</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="93">
            <span class="hits">8</span>
            

            

            <code class="ruby">      errors.add(:startTime, &quot;#{startTime} is not a valid rfc3339 date&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="96">
            <span class="hits">615</span>
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="97">
            <span class="hits">615</span>
            

            

            <code class="ruby">      DateTime.rfc3339(endTime) unless endTime.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">    rescue</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="99">
            <span class="hits">8</span>
            

            

            <code class="ruby">      errors.add(:endTime, &quot;#{endTime} is not a valid rfc3339 date&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="103">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def geometry_is_point_line_polygon</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="104">
            <span class="hits">615</span>
            

            

            <code class="ruby">    unless geometry.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="105">
            <span class="hits">50</span>
            

            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="106">
            <span class="hits">50</span>
            

            

            <code class="ruby">        factory = RGeo::Cartesian.factory</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="107">
            <span class="hits">50</span>
            

            

            <code class="ruby">        g = factory.parse_wkt(geometry)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="108">
            <span class="hits">46</span>
            

            

            <code class="ruby">        point = ::RGeo::Feature::Point.check_type(g)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="109">
            <span class="hits">46</span>
            

            

            <code class="ruby">        line = ::RGeo::Feature::LineString.check_type(g)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="110">
            <span class="hits">46</span>
            

            

            <code class="ruby">        polygon = ::RGeo::Feature::Polygon.check_type(g)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="111">
            <span class="hits">46</span>
            

            

            <code class="ruby">        errors.add(:geometry, &quot;#{geometry} is not supported, please use POINT, LINESTRING or POLYGON&quot;) if !point and !line and !polygon</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">      rescue</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="113">
            <span class="hits">4</span>
            

            

            <code class="ruby">        errors.add(:geometry, &quot;#{geometry} is not a valid WKT&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="118">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def bbox_is_valid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="119">
            <span class="hits">615</span>
            

            

            <code class="ruby">    unless boundingBox.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="120">
            <span class="hits">42</span>
            

            

            <code class="ruby">      ordinates = boundingBox.gsub(/\s+/, &quot;&quot;).split(&#39;,&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="121">
            <span class="hits">42</span>
            

            

            <code class="ruby">      if ordinates.length != 4</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="122">
            <span class="hits">12</span>
            

            

            <code class="ruby">        errors.add(:boundingBox, &quot;#{boundingBox} is not a valid boundingBox&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="124">
            <span class="hits">30</span>
            

            

            <code class="ruby">        valid = lon_is_valid(:boundingBox, ordinates[0], boundingBox)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="125">
            <span class="hits">30</span>
            

            

            <code class="ruby">        valid = lat_is_valid(:boundingBox, ordinates[1], boundingBox) if valid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="126">
            <span class="hits">30</span>
            

            

            <code class="ruby">        valid = lon_is_valid(:boundingBox, ordinates[2], boundingBox) if valid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="127">
            <span class="hits">30</span>
            

            

            <code class="ruby">        lat_is_valid(:boundingBox, ordinates[3], boundingBox) if valid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="132">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def point_radius_is_valid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="133">
            <span class="hits">615</span>
            

            

            <code class="ruby">    unless lat.blank? and lon.blank? and radius.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="134">
            <span class="hits">14</span>
            

            

            <code class="ruby">      errors.add(:lat, &quot;cannot be empty for point radius search&quot;) if lat.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="135">
            <span class="hits">14</span>
            

            

            <code class="ruby">      errors.add(:lon, &quot;cannot be empty for point radius search&quot;) if lon.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="136">
            <span class="hits">14</span>
            

            

            <code class="ruby">      errors.add(:radius, &quot;cannot be empty for point radius search&quot;) if radius.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="140">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def lat_is_valid(symbol, lat_string, full)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="141">
            <span class="hits">52</span>
            

            

            <code class="ruby">    valid = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="142">
            <span class="hits">52</span>
            

            

            <code class="ruby">    lat_float = lat_string.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="143">
            <span class="hits">52</span>
            

            

            <code class="ruby">    if (not [&quot;0&quot;, &quot;0.0&quot;].include?(lat_string)) and lat_float == 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            
            

            

            <code class="ruby">      errors.add(symbol, &quot;#{full} is not a valid #{symbol.to_s}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">      valid = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="147">
            <span class="hits">52</span>
            

            

            <code class="ruby">      if lat_float &lt; -90 or lat_float &gt; 90</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="148">
            <span class="hits">4</span>
            

            

            <code class="ruby">        errors.add(symbol, &quot;#{full} is not a valid #{symbol.to_s}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="149">
            <span class="hits">4</span>
            

            

            <code class="ruby">        valid = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="152">
            <span class="hits">52</span>
            

            

            <code class="ruby">    valid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="155">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def lon_is_valid(symbol, lon_string, full)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="156">
            <span class="hits">56</span>
            

            

            <code class="ruby">    valid = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="157">
            <span class="hits">56</span>
            

            

            <code class="ruby">    lon_float = lon_string.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">    #to include non-float representations of 0.0, becuase 0 == 0.0!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="159">
            <span class="hits">56</span>
            

            

            <code class="ruby">    if (not [&quot;0&quot;, &quot;0.0&quot;].include?(lon_string)) and lon_float == 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="160">
            
            

            

            <code class="ruby">      errors.add(symbol, &quot;#{full} is not a valid #{symbol.to_s}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">      valid = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="163">
            <span class="hits">56</span>
            

            

            <code class="ruby">      if lon_float &lt; -180 or lon_float &gt; 180</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="164">
            <span class="hits">4</span>
            

            

            <code class="ruby">        errors.add(symbol, &quot;#{full} is not a valid #{symbol.to_s}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="165">
            <span class="hits">4</span>
            

            

            <code class="ruby">        valid = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="168">
            <span class="hits">56</span>
            

            

            <code class="ruby">    valid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="171">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.hits document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="268" data-linenumber="172">
            <span class="hits">268</span>
            

            

            <code class="ruby">    document.root.xpath(&#39;os:totalResults&#39;, &#39;os&#39; =&gt; &#39;http://a9.com/-/spec/opensearch/1.1/&#39;).first.to_str.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="175">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.create_html_model(entry)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="438" data-linenumber="176">
            <span class="hits">438</span>
            

            

            <code class="ruby">    model = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="438" data-linenumber="177">
            <span class="hits">438</span>
            

            

            <code class="ruby">    model.links = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="438" data-linenumber="178">
            <span class="hits">438</span>
            

            

            <code class="ruby">    entry.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="179">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.title = node.content if node.name == &#39;title&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="180">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.uid = node.content if node.name == &#39;id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="181">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.start = node.content if node.name == &#39;start&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="182">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.stop = node.content if node.name == &#39;end&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="183">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.bounding_box = node.content if node.name == &#39;box&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="184">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.polygon= node.content if node.name == &#39;polygon&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="185">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.line = node.content if node.name == &#39;line&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="186">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.point = node.content if node.name == &#39;point&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="187">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.mbr = node.content if node.name == &#39;box&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="188">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      model.temporal_extent = node.content if node.name == &#39;date&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6065" data-linenumber="189">
            <span class="hits">6065</span>
            

            

            <code class="ruby">      if node.name == &#39;link&#39; and node[:type] != &#39;application/atom+xml&#39; and node[:type] != &#39;application/opensearchdescription+xml&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="190">
            <span class="hits">639</span>
            

            

            <code class="ruby">        url = OpenStruct.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="191">
            <span class="hits">639</span>
            

            

            <code class="ruby">        url.href = node[:href]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="192">
            <span class="hits">639</span>
            

            

            <code class="ruby">        url.title = node[:title]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="193">
            <span class="hits">639</span>
            

            

            <code class="ruby">        url.title = &quot;Browse image link&quot; if url.title.nil? and node[:rel] == &#39;icon&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="194">
            <span class="hits">639</span>
            

            

            <code class="ruby">        url.title = &quot;Data link&quot; if url.title.nil? and node[:rel] == &#39;enclosure&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="195">
            <span class="hits">639</span>
            

            

            <code class="ruby">        url.title = &quot;Metadata link&quot; if url.title.nil? and node[:rel] == &#39;describedBy&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="196">
            <span class="hits">639</span>
            

            

            <code class="ruby">        url.title = &quot;Documentation link&quot; if url.title.nil? and node[:rel] == &#39;describedBy&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="639" data-linenumber="197">
            <span class="hits">639</span>
            

            

            <code class="ruby">        if url.title == &#39;Product metadata&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="415" data-linenumber="198">
            <span class="hits">415</span>
            

            

            <code class="ruby">          model.canononical_link = url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="224" data-linenumber="200">
            <span class="hits">224</span>
            

            

            <code class="ruby">          model.links &lt;&lt; url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="438" data-linenumber="205">
            <span class="hits">438</span>
            

            

            <code class="ruby">    model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby">  # There is a reason we don&#39;t simplify this by using xpath. It is really slow over large result sets. Slow enough to generate user complaints.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="209">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_open_search_common (doc, hits, params, resource)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            
            

            

            <code class="ruby">    # Add open search namespace</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="211">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;os&#39;, &#39;http://a9.com/-/spec/opensearch/1.1/&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby">    # Add esip namespace</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="213">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;eo&#39;, &#39;http://a9.com/-/opensearch/extensions/eo/1.0/&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="214">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;esipdiscovery&#39;, &#39;http://commons.esipfed.org/ns/discovery/1.2/&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="215">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;dc&#39;, &#39;http://purl.org/dc/elements/1.1/&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="216">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;georss&#39;, &#39;http://www.georss.org/georss&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="217">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;time&#39;, &#39;http://a9.com/-/opensearch/extensions/time/1.0/&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="218">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;echo&#39;, &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="219">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.add_namespace &#39;gml&#39;, &#39;http://www.opengis.net/gml&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="220">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root[&#39;esipdiscovery:version&#39;] = &#39;1.2&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="222">
            <span class="hits">287</span>
            

            

            <code class="ruby">    subtitle_node = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="223">
            <span class="hits">287</span>
            

            

            <code class="ruby">    first_entry = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="224">
            <span class="hits">287</span>
            

            

            <code class="ruby">    doc.root.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3697" data-linenumber="225">
            <span class="hits">3697</span>
            

            

            <code class="ruby">      if node.name == &#39;id&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="226">
            <span class="hits">287</span>
            

            

            <code class="ruby">        node.content = &quot;#{ENV[&#39;opensearch_url&#39;]}/#{resource}s.atom&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="227">
            <span class="hits">287</span>
            

            

            <code class="ruby">        add_author(doc, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3410" data-linenumber="228">
            <span class="hits">3410</span>
            

            

            <code class="ruby">      elsif node.name == &#39;entry&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="229">
            <span class="hits">1137</span>
            

            

            <code class="ruby">        first_entry = node if first_entry.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="233">
            <span class="hits">287</span>
            

            

            <code class="ruby">    first_entry = doc.root.children.last if first_entry.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            
            

            

            <code class="ruby">    # Add subtitle node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="235">
            <span class="hits">287</span>
            

            

            <code class="ruby">    subtitle_node = add_subtitle(doc, first_entry, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="237">
            <span class="hits">287</span>
            

            

            <code class="ruby">    link = add_link_as_sibling(doc, subtitle_node, ENV[&#39;release_page&#39;], &#39;text/html&#39;, &#39;describedBy&#39;, &#39;Release Notes&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            
            

            

            <code class="ruby">    # Add query node prior to first entry node</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="240">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node = add_query_node(doc, link, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            
            

            

            <code class="ruby">    # Add the hits, items and cursor elements after the Atom elements</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="242">
            <span class="hits">287</span>
            

            

            <code class="ruby">    hits_node = Nokogiri::XML::Node.new &#39;os:totalResults&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="243">
            <span class="hits">287</span>
            

            

            <code class="ruby">    hits_node.content= hits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="244">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node.add_next_sibling(hits_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="245">
            <span class="hits">287</span>
            

            

            <code class="ruby">    if hits.to_i &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="246">
            <span class="hits">246</span>
            

            

            <code class="ruby">      items_node = Nokogiri::XML::Node.new &#39;os:itemsPerPage&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="247">
            <span class="hits">246</span>
            

            

            <code class="ruby">      items_node.content = params[:numberOfResults] || 10</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="248">
            <span class="hits">246</span>
            

            

            <code class="ruby">      hits_node.add_next_sibling(items_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="249">
            <span class="hits">246</span>
            

            

            <code class="ruby">      nor = params[:numberOfResults].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby">      # offset overwrites cursor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="251">
            <span class="hits">246</span>
            

            

            <code class="ruby">      if !params[:offset].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="252">
            <span class="hits">23</span>
            

            

            <code class="ruby">        start_index = (params[:offset].to_i + 1).to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="223" data-linenumber="254">
            <span class="hits">223</span>
            

            

            <code class="ruby">        cursor = params[:cursor].to_i || 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="223" data-linenumber="255">
            <span class="hits">223</span>
            

            

            <code class="ruby">        start_index = to_start_index(cursor, nor)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="257">
            <span class="hits">246</span>
            

            

            <code class="ruby">      cursor_node = Nokogiri::XML::Node.new &#39;os:startIndex&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="258">
            <span class="hits">246</span>
            

            

            <code class="ruby">      cursor_node.content = start_index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="246" data-linenumber="259">
            <span class="hits">246</span>
            

            

            <code class="ruby">      items_node.add_next_sibling(cursor_node)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="261">
            <span class="hits">287</span>
            

            

            <code class="ruby">    return doc, subtitle_node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="264">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_start_index(cursor, number_of_results)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="227" data-linenumber="265">
            <span class="hits">227</span>
            

            

            <code class="ruby">    cursor*number_of_results + 1 - number_of_results</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="269">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_cmr_params(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="270">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="272">
            <span class="hits">296</span>
            

            

            <code class="ruby">    unless params[:cursor].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="258" data-linenumber="273">
            <span class="hits">258</span>
            

            

            <code class="ruby">      value = params[:cursor]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="258" data-linenumber="274">
            <span class="hits">258</span>
            

            

            <code class="ruby">      value = 1 if value.to_i &lt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="258" data-linenumber="275">
            <span class="hits">258</span>
            

            

            <code class="ruby">      cmr_params[:page_num] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="278">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params[:page_size] = params[:numberOfResults] unless params[:numberOfResults].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="279">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params[:offset] = params[:offset] unless params[:offset].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="280">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params[:instrument] = params[:instrument] unless params[:instrument].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="281">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params[:platform] = params[:satellite] unless params[:satellite].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="282">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params[:include_facets] = params[:include_facets] unless params[:include_facets].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="284">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params[:bounding_box] = params[:boundingBox].gsub(/\s+/, &quot;&quot;) unless params[:boundingBox].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="285">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params[:circle] = &quot;#{params[:lon]},#{params[:lat]},#{params[:radius]}&quot; unless params[:lat].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="287">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params = WellFormedText.add_cmr_param(cmr_params, params[:geometry]) unless params[:geometry].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="289">
            <span class="hits">296</span>
            

            

            <code class="ruby">    unless params[:polygon].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="290">
            
            

            

            <code class="ruby">      value = params[:polygon]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="291">
            
            

            

            <code class="ruby">      cmr_value = to_lon_lat(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="292">
            
            

            

            <code class="ruby">      cmr_value = close_polygon (cmr_value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="293">
            
            

            

            <code class="ruby">      cmr_params[:polygon] = cmr_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="296">
            <span class="hits">296</span>
            

            

            <code class="ruby">    unless params[:line].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="297">
            
            

            

            <code class="ruby">      value = params[:line]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="298">
            
            

            

            <code class="ruby">      cmr_value = to_lon_lat(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="299">
            
            

            

            <code class="ruby">      cmr_params[:line] = cmr_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="302">
            <span class="hits">296</span>
            

            

            <code class="ruby">    unless params[:point].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="303">
            
            

            

            <code class="ruby">      value = params[:point]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="304">
            
            

            

            <code class="ruby">      cmr_value = to_lon_lat(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="305">
            
            

            

            <code class="ruby">      cmr_params[:point] = cmr_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="308">
            <span class="hits">296</span>
            

            

            <code class="ruby">    cmr_params = PlaceNameToPoint.add_cmr_param(cmr_params, params[:placeName]) unless params[:placeName].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="310">
            <span class="hits">296</span>
            

            

            <code class="ruby">    unless params[:startTime].blank? and params[:endTime].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="311">
            <span class="hits">30</span>
            

            

            <code class="ruby">      cmr_params[:temporal] = &quot;#{params[:startTime]},#{params[:endTime]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="296" data-linenumber="316">
            <span class="hits">296</span>
            

            

            <code class="ruby">    return cmr_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            
            

            

            <code class="ruby">  # open search using lat/lon pairs, cmr uses lon/lat, both use closed polygons.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="320">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def to_lon_lat(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="321">
            
            

            

            <code class="ruby">    ordinates = value.gsub(/\s+/, &quot;&quot;).split(&#39;,&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="322">
            
            

            

            <code class="ruby">    cmr_value=&quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="323">
            
            

            

            <code class="ruby">    range = 0..ordinates.size</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="324">
            
            

            

            <code class="ruby">    range.step(2) { |x| cmr_value += &quot;#{ordinates[x+1]},#{ordinates[x]},&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            
            

            

            <code class="ruby">    # Remove last comma</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="326">
            
            

            

            <code class="ruby">    while cmr_value.ends_with?(&#39;,&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="327">
            
            

            

            <code class="ruby">      cmr_value.chomp!(&#39;,&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="329">
            
            

            

            <code class="ruby">    cmr_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            
            

            

            <code class="ruby">  # open search uses open polygons, cmr uses closed polygons</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="333">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def close_polygon(value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="334">
            
            

            

            <code class="ruby">    ordinates = value.gsub(/\s+/, &quot;&quot;).split(&#39;,&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="335">
            
            

            

            <code class="ruby">    cmr_value = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            
            

            

            <code class="ruby">    # Grab first two and append</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="338">
            
            

            

            <code class="ruby">    if ordinates.length &gt; 3</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="339">
            
            

            

            <code class="ruby">      cmr_value.concat(&quot;,#{ordinates[0]},#{ordinates[1]}&quot;) unless ordinates[0] == ordinates[ordinates.length - 2] &amp;&amp; ordinates[1] == ordinates[ordinates.length - 1]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="341">
            
            

            

            <code class="ruby">    cmr_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="342">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="344">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_link_as_child(doc, entry, href, type, rel, title=nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="345">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link = Nokogiri::XML::Node.new &#39;link&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="346">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link[:href] = href</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="347">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link[:hreflang] = &#39;en-US&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="348">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link[:type] = type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="349">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link[:rel] = rel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="350">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link = fix_rel link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="352">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link[:title] = title unless title.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="353">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    entry.add_child(link)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1595" data-linenumber="354">
            <span class="hits">1595</span>
            

            

            <code class="ruby">    link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="355">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="357">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_link_as_sibling(doc, entry, href, type, rel, title=nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="358">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link = Nokogiri::XML::Node.new &#39;link&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="359">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link[:href] = href</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="360">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link[:hreflang] = &#39;en-US&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="361">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link[:type] = type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="362">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link[:rel] = rel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="363">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link = fix_rel link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="364">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="365">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link[:title] = title unless title.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="366">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    entry.add_next_sibling(link)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1569" data-linenumber="367">
            <span class="hits">1569</span>
            

            

            <code class="ruby">    link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="370">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_dc_temporal_extent(doc, entry, start_time, end_time)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="759" data-linenumber="371">
            <span class="hits">759</span>
            

            

            <code class="ruby">    date = Nokogiri::XML::Node.new &#39;dc:date&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="759" data-linenumber="372">
            <span class="hits">759</span>
            

            

            <code class="ruby">    content = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="759" data-linenumber="373">
            <span class="hits">759</span>
            

            

            <code class="ruby">    unless start_time == end_time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="682" data-linenumber="374">
            <span class="hits">682</span>
            

            

            <code class="ruby">      content = &quot;#{start_time}/#{end_time}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="376">
            <span class="hits">77</span>
            

            

            <code class="ruby">      content = &quot;#{start_time}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="759" data-linenumber="378">
            <span class="hits">759</span>
            

            

            <code class="ruby">    date.content = content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="759" data-linenumber="379">
            <span class="hits">759</span>
            

            

            <code class="ruby">    entry.add_child(date)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="759" data-linenumber="380">
            <span class="hits">759</span>
            

            

            <code class="ruby">    date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="381">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="382">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="383">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def fix_rel(link)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6177" data-linenumber="384">
            <span class="hits">6177</span>
            

            

            <code class="ruby">    unless link[:rel] == &#39;enclosure&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5829" data-linenumber="385">
            <span class="hits">5829</span>
            

            

            <code class="ruby">      if DOCUMENTATION_MIME_TYPES.include? link[:type] or DOCUMENTATION_EXTENSIONS.include? link[:href].split(&#39;.&#39;).last</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="517" data-linenumber="386">
            <span class="hits">517</span>
            

            

            <code class="ruby">        link[:rel] = NEW_REL_MAPPING[:documentation]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="387">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            
            

            

            <code class="ruby">      # Translate link</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5829" data-linenumber="390">
            <span class="hits">5829</span>
            

            

            <code class="ruby">      link[:rel] = NEW_REL_MAPPING.fetch(OLD_REL_MAPPING.key(link[:rel])) if OLD_REL_MAPPING.value?(link[:rel]) and link[:rel] != NEW_REL_MAPPING[:documentation]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="391">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6177" data-linenumber="392">
            <span class="hits">6177</span>
            

            

            <code class="ruby">    link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="395">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_type(link)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2752" data-linenumber="396">
            <span class="hits">2752</span>
            

            

            <code class="ruby">    if link[:type].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="397">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;application/x-hdfeos&#39; if link[:href].ends_with? &#39;.hdf&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="398">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;application/xml&#39; if link[:href].ends_with? &#39;.xml&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="399">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;application/xml&#39; if link[:href].ends_with? &#39;.echo10&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="400">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;image/png&#39; if link[:href].ends_with? &#39;.png&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="401">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;image/gif&#39; if link[:href].ends_with? &#39;.gif&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="402">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;image/jpeg&#39; if link[:href].ends_with? &#39;.jpg&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="403">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;image/jpeg&#39; if link[:href].ends_with? &#39;.jpeg&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="404">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;application/pdf&#39; if link[:href].ends_with? &#39;.pdf&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="405">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;text/html&#39; if link[:href].ends_with? &#39;.html&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2357" data-linenumber="406">
            <span class="hits">2357</span>
            

            

            <code class="ruby">      link[:type] = &#39;text/html&#39; if link[:href].include? &#39;.pl&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="407">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2752" data-linenumber="408">
            <span class="hits">2752</span>
            

            

            <code class="ruby">    link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="409">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="410">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="411">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def fix_inherited(link)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="435" data-linenumber="412">
            <span class="hits">435</span>
            

            

            <code class="ruby">    link.attribute(&#39;inherited&#39;).name = &#39;echo:inherited&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="435" data-linenumber="413">
            <span class="hits">435</span>
            

            

            <code class="ruby">    link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="414">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="415">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="416">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_query_node(doc, node, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="417">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node = Nokogiri::XML::Node.new &quot;os:Query&quot;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="418">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node.add_namespace &#39;geo&#39;, &#39;http://a9.com/-/opensearch/extensions/geo/1.0/&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="419">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node.add_namespace &#39;time&#39;, &#39;http://a9.com/-/opensearch/extensions/time/1.0/&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="420">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node.add_namespace &#39;echo&#39;, &#39;https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html#atom&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="421">
            <span class="hits">287</span>
            

            

            <code class="ruby">    node.add_next_sibling(query_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="422">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[:role] = &#39;request&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="423">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;os:searchTerms&#39;] = params[:keyword] unless params[:keyword].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="424">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;echo:dataCenter&#39;] = params[:dataCenter] unless params[:dataCenter].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="425">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;echo:shortName&#39;] = params[:shortName] unless params[:shortName].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="426">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;echo:versionId&#39;] = params[:versionId] unless params[:versionId].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="427">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;echo:instrument&#39;] = params[:instrument] unless params[:instrument].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="428">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;eo:platform&#39;] = params[:satellite] unless params[:satellite].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="429">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;echo:campaign&#39;] = params[:campaign] unless params[:campaign].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="430">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;echo:sensor&#39;] = params[:sensor] unless params[:sensor].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="431">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;echo:processing_level&#39;] = params[:processingLevel] unless params[:processingLevel].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="432">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;geo:box&#39;] = params[:boundingBox] unless params[:boundingBox].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="433">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;geo:geometry&#39;] = params[:geometry] unless params[:geometry].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="434">
            
            

            

            <code class="ruby">    #query_node[&#39;geo:geometry&#39;] = params[:line] unless params[:line].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="435">
            
            

            

            <code class="ruby">    #query_node[&#39;geo:geometry&#39;] = params[:point] unless params[:point].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="436">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;time:start&#39;] = params[:startTime] unless params[:startTime].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="437">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;time:end&#39;] = params[:endTime] unless params[:endTime].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="438">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="439">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node[&#39;geo:uid&#39;] = params[:uid] unless params[:uid].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="440">
            
            

            

            <code class="ruby">    # per OGC OpenSearch RELAX NG ATOM response schema, we cannot add fixed parameters to the request os:Query element</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="441">
            
            

            

            <code class="ruby">    #query_node[&#39;clientId&#39;] = params[:clientId] unless params[:clientId].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="442">
            <span class="hits">287</span>
            

            

            <code class="ruby">    query_node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="443">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="445">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_subtitle(doc, node, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="446">
            <span class="hits">287</span>
            

            

            <code class="ruby">    subtitle = Nokogiri::XML::Node.new &#39;subtitle&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="447">
            <span class="hits">287</span>
            

            

            <code class="ruby">    subtitle[:type] = &#39;text&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="448">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="449">
            <span class="hits">287</span>
            

            

            <code class="ruby">    if doc.xpath(&#39;/atom:feed/atom:entry&#39;, &#39;atom&#39; =&gt; &#39;http://www.w3.org/2005/Atom&#39;).length == 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="450">
            <span class="hits">34</span>
            

            

            <code class="ruby">      subtitle.content = &quot;Your search yielded zero matches&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="451">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="452">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content = &quot;Search parameters:&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="453">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; keyword =&gt; #{params[:keyword]}&quot; unless params[:keyword].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="454">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; shortName =&gt; #{params[:shortName]}&quot; unless params[:shortName].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="455">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; versionId =&gt; #{params[:versionId]}&quot; unless params[:versionId].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="456">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; dataCenter =&gt; #{params[:dataCenter]}&quot; unless params[:dataCenter].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="457">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; instrument =&gt; #{params[:instrument]}&quot; unless params[:instrument].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="458">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; satellite =&gt; #{params[:satellite]}&quot; unless params[:satellite].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="459">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; campaign =&gt; #{params[:campaign]}&quot; unless params[:campaign].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="460">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; sensor =&gt; #{params[:sensor]}&quot; unless params[:sensor].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="461">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; processingLevel =&gt; #{params[:processingLevel]}&quot; unless params[:processingLevel].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="462">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; boundingBox =&gt; #{params[:boundingBox]}&quot; unless params[:boundingBox].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="463">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; geometry =&gt; #{params[:geometry]}&quot; unless params[:geometry].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="464">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; placeName =&gt; #{params[:placeName]}&quot; unless params[:placeName].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="465">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; startTime =&gt; #{params[:startTime]}&quot; unless params[:startTime].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="466">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; endTime =&gt; #{params[:endTime]}&quot; unless params[:endTime].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="467">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &quot; uid =&gt; #{params[:uid]}&quot; unless params[:uid].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="468">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="253" data-linenumber="469">
            <span class="hits">253</span>
            

            

            <code class="ruby">      subtitle.content += &#39; None&#39; if subtitle.content == &#39;Search parameters:&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="470">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="471">
            <span class="hits">287</span>
            

            

            <code class="ruby">    node.before(subtitle)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="472">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="473">
            <span class="hits">287</span>
            

            

            <code class="ruby">    subtitle</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="474">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="475">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="476">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_author(doc, node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="477">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    author_node = Nokogiri::XML::Node.new &quot;author&quot;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="478">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    name_node = Nokogiri::XML::Node.new &quot;name&quot;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="479">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    name_node.content = &#39;CMR&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="480">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    email_node = Nokogiri::XML::Node.new &quot;email&quot;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="481">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    email_node.content = &quot;#{ENV[&#39;contact&#39;]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="482">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    author_node.add_child(name_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="483">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    author_node.add_child(email_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="484">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    node.add_next_sibling(author_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1163" data-linenumber="485">
            <span class="hits">1163</span>
            

            

            <code class="ruby">    node</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="486">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="487">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="488">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_dc_identifier(doc, id, parent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="489">
            <span class="hits">1137</span>
            

            

            <code class="ruby">    dc_identifier_node = Nokogiri::XML::Node.new &#39;dc:identifier&#39;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="490">
            <span class="hits">1137</span>
            

            

            <code class="ruby">    dc_identifier_node.content = id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="491">
            <span class="hits">1137</span>
            

            

            <code class="ruby">    parent.add_child(dc_identifier_node)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1137" data-linenumber="492">
            <span class="hits">1137</span>
            

            

            <code class="ruby">    parent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="493">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="494">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="495">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_common_summary(doc, entry, summary)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="496">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="497">
            
            

            

            <code class="ruby">    # Using xpath is a resource hog for large results set, hence the mess below</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="498">
            
            

            

            <code class="ruby">    start_time, end_time, bbox, polygon, line, point = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="499">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="500">
            
            

            

            <code class="ruby">    entry.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="501">
            
            

            

            <code class="ruby">      start_time = node.inner_text if node.name == &#39;start&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="502">
            
            

            

            <code class="ruby">      end_time = node.inner_text if node.name == &#39;end&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="503">
            
            

            

            <code class="ruby">      bbox = node.inner_text if node.name == &#39;box&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="504">
            
            

            

            <code class="ruby">      polygon = node.inner_text if node.name == &#39;polygon&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="505">
            
            

            

            <code class="ruby">      line = node.inner_text if node.name == &#39;line&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="506">
            
            

            

            <code class="ruby">      point = node.inner_text if node.name == &#39;point&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="507">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="508">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="509">
            
            

            

            <code class="ruby">    unless start_time.blank? and end_time.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="510">
            
            

            

            <code class="ruby">      summary += &quot;&lt;p&gt;&lt;b&gt;Temporal Extent&lt;/b&gt;&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="511">
            
            

            

            <code class="ruby">      summary += &quot;&lt;p&gt;&lt;b&gt;Start Time: &lt;/b&gt;#{start_time}&quot; unless start_time.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="512">
            
            

            

            <code class="ruby">      summary += &quot;&lt;p&gt;&lt;b&gt;End Time: &lt;/b&gt;#{end_time}&quot; unless end_time.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="513">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="514">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="515">
            
            

            

            <code class="ruby">    if !polygon.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="516">
            
            

            

            <code class="ruby">      spatial_exent_for_summary = &quot;&lt;b&gt;Polygon: &lt;/b&gt;#{polygon}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="517">
            
            

            

            <code class="ruby">    elsif !line.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="518">
            
            

            

            <code class="ruby">      spatial_exent_for_summary = &quot;&lt;b&gt;Line: &lt;/b&gt;#{line}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="519">
            
            

            

            <code class="ruby">    elsif !point.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="520">
            
            

            

            <code class="ruby">      spatial_exent_for_summary = &quot;&lt;b&gt;Point: &lt;/b&gt;#{point}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="521">
            
            

            

            <code class="ruby">    elsif !bbox.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="522">
            
            

            

            <code class="ruby">      spatial_exent_for_summary = &quot;&lt;b&gt;Bounding Box: &lt;/b&gt;#{bbox}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="523">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="524">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="525">
            
            

            

            <code class="ruby">    summary += &quot;&lt;p&gt;&lt;b&gt;Spatial Extent&lt;/b&gt;&lt;/p&gt;#{spatial_exent_for_summary}&quot; unless spatial_exent_for_summary.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="526">
            
            

            

            <code class="ruby">    summary_element = Nokogiri::XML::Node.new &quot;summary&quot;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="527">
            
            

            

            <code class="ruby">    summary_element.content = summary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="528">
            
            

            

            <code class="ruby">    summary_element[:type] =&quot;html&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="529">
            
            

            

            <code class="ruby">    summary_element</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="530">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="531">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="532">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_nav_links(doc, sibling, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="533">
            <span class="hits">287</span>
            

            

            <code class="ruby">    if !params[:offset].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="534">
            <span class="hits">24</span>
            

            

            <code class="ruby">      add_offset_nav_links(doc, sibling, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="535">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="536">
            <span class="hits">263</span>
            

            

            <code class="ruby">      add_cursor_nav_links(doc, sibling, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="537">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="538">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="539">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="540">
            
            

            

            <code class="ruby">  # navigation via offset (os:startIndex), CMR offset and CMR OpenSearch offset are 0-based</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="541">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_offset_nav_links(doc, sibling, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="542">
            <span class="hits">24</span>
            

            

            <code class="ruby">    url.gsub!(&#39;datasets?&#39;, &#39;collections?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="543">
            <span class="hits">24</span>
            

            

            <code class="ruby">    search_link = add_link_as_sibling(doc, sibling, url, &#39;application/atom+xml&#39;, &#39;self&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="544">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="545">
            
            

            

            <code class="ruby">    # Remove offset parameter from url string if present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="546">
            <span class="hits">24</span>
            

            

            <code class="ruby">    remove_url_query_parameter(params, url, &#39;offset&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="547">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="548">
            <span class="hits">24</span>
            

            

            <code class="ruby">    page_size = (number_of_results || params[:numberOfResults]).to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="549">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="550">
            <span class="hits">24</span>
            

            

            <code class="ruby">    if(hits &gt; 0 )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="551">
            
            

            

            <code class="ruby">      # Insert first link for offset navigation, always present as offset 0 if we have hits</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="552">
            <span class="hits">23</span>
            

            

            <code class="ruby">      first_link_possible = params[:offset].to_i - page_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="553">
            <span class="hits">23</span>
            

            

            <code class="ruby">      first_link_offset = first_link_possible % page_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="554">
            <span class="hits">23</span>
            

            

            <code class="ruby">      if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="555">
            <span class="hits">23</span>
            

            

            <code class="ruby">        first_url = url + (first_link_possible &gt;= 0 ? &quot;&amp;offset=#{first_link_offset}&quot; : &quot;&amp;offset=#{params[:offset]}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="556">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="557">
            
            

            

            <code class="ruby">        first_url = url + (first_link_possible &gt;= 0 ? &quot;?offset=#{first_link_offset}&quot; : &quot;?offset=#{params[:offset]}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="558">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="559">
            <span class="hits">23</span>
            

            

            <code class="ruby">      add_link_as_sibling(doc, search_link, first_url, &#39;application/atom+xml&#39;, &#39;first&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="560">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="561">
            
            

            

            <code class="ruby">      # Insert last link - calculate last offset</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="562">
            <span class="hits">23</span>
            

            

            <code class="ruby">      elements_from_offset_to_last = hits - params[:offset].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="563">
            <span class="hits">23</span>
            

            

            <code class="ruby">      pages_from_offset_to_last = elements_from_offset_to_last / page_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="564">
            <span class="hits">23</span>
            

            

            <code class="ruby">      last_offset =  params[:offset].to_i + pages_from_offset_to_last*page_size unless page_size.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="565">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="566">
            <span class="hits">23</span>
            

            

            <code class="ruby">      if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="567">
            <span class="hits">23</span>
            

            

            <code class="ruby">        last_url = url + &quot;&amp;offset=#{last_offset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="568">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="569">
            
            

            

            <code class="ruby">        last_url = url + &quot;?offset=#{last_offset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="570">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="571">
            <span class="hits">23</span>
            

            

            <code class="ruby">      last_link = add_link_as_sibling(doc, search_link, last_url, &#39;application/atom+xml&#39;, &#39;last&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="572">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="573">
            
            

            

            <code class="ruby">      # Insert next link</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="574">
            <span class="hits">23</span>
            

            

            <code class="ruby">      if need_next_offset?(params, hits)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="575">
            <span class="hits">15</span>
            

            

            <code class="ruby">        next_offset = params[:offset].to_i + page_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="576">
            <span class="hits">15</span>
            

            

            <code class="ruby">        if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="577">
            <span class="hits">15</span>
            

            

            <code class="ruby">          next_url = url + &quot;&amp;offset=#{next_offset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="578">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="579">
            
            

            

            <code class="ruby">          next_url = url + &quot;?offset=#{next_offset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="580">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="581">
            <span class="hits">15</span>
            

            

            <code class="ruby">        add_link_as_sibling(doc, last_link, next_url, &#39;application/atom+xml&#39;, &#39;next&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="582">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="583">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="584">
            
            

            

            <code class="ruby">      # Insert previous link</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="585">
            <span class="hits">23</span>
            

            

            <code class="ruby">      if need_prev_offset?(params, hits)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="586">
            <span class="hits">18</span>
            

            

            <code class="ruby">        previous_offset = params[:offset].to_i - page_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="587">
            <span class="hits">18</span>
            

            

            <code class="ruby">        if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="588">
            <span class="hits">18</span>
            

            

            <code class="ruby">          previous_url = url + &quot;&amp;offset=#{previous_offset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="589">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="590">
            
            

            

            <code class="ruby">          previous_url = url + &quot;?offset=#{previous_offset}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="591">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="592">
            <span class="hits">18</span>
            

            

            <code class="ruby">        add_link_as_sibling(doc, last_link, previous_url, &#39;application/atom+xml&#39;, &#39;previous&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="593">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="594">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="595">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="596">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="597">
            
            

            

            <code class="ruby">  # support cursor (os:startPage) pagination</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="598">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def add_cursor_nav_links(doc, sibling, hits, params, url)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="599">
            <span class="hits">263</span>
            

            

            <code class="ruby">    url.gsub!(&#39;datasets?&#39;, &#39;collections?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="600">
            <span class="hits">263</span>
            

            

            <code class="ruby">    search_link = add_link_as_sibling(doc, sibling, url, &#39;application/atom+xml&#39;, &#39;self&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="601">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="602">
            
            

            

            <code class="ruby">    # Remove cursor query parameter if present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="603">
            <span class="hits">263</span>
            

            

            <code class="ruby">    remove_url_query_parameter(params, url, &#39;cursor&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="604">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="605">
            
            

            

            <code class="ruby">    # Insert first link for cursor navigation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="606">
            <span class="hits">263</span>
            

            

            <code class="ruby">    if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="222" data-linenumber="607">
            <span class="hits">222</span>
            

            

            <code class="ruby">      first_url = url + &#39;&amp;cursor=1&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="608">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="609">
            <span class="hits">41</span>
            

            

            <code class="ruby">      first_url = url + &#39;?cursor=1&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="610">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="611">
            <span class="hits">263</span>
            

            

            <code class="ruby">    add_link_as_sibling(doc, search_link, first_url, &#39;application/atom+xml&#39;, &#39;first&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="612">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="613">
            
            

            

            <code class="ruby">    # Insert last link - calculate last cursor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="614">
            <span class="hits">263</span>
            

            

            <code class="ruby">    nor = number_of_results || params[:numberOfResults]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="615">
            <span class="hits">263</span>
            

            

            <code class="ruby">    last_cursor = hits/nor.to_i + 1 unless nor.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="616">
            <span class="hits">263</span>
            

            

            <code class="ruby">    last_cursor = 1 if nor.nil? || last_cursor &lt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="617">
            <span class="hits">263</span>
            

            

            <code class="ruby">    if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="222" data-linenumber="618">
            <span class="hits">222</span>
            

            

            <code class="ruby">      last_url = url + &quot;&amp;cursor=#{last_cursor}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="619">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="620">
            <span class="hits">41</span>
            

            

            <code class="ruby">      last_url = url + &quot;?cursor=#{last_cursor}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="621">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="622">
            <span class="hits">263</span>
            

            

            <code class="ruby">    last_link = add_link_as_sibling(doc, search_link, last_url, &#39;application/atom+xml&#39;, &#39;last&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="623">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="624">
            
            

            

            <code class="ruby">    # Insert next link</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="625">
            <span class="hits">263</span>
            

            

            <code class="ruby">    if need_next_cursor?(params, hits)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="111" data-linenumber="626">
            <span class="hits">111</span>
            

            

            <code class="ruby">      next_cursor = params[:cursor].to_i + 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="111" data-linenumber="627">
            <span class="hits">111</span>
            

            

            <code class="ruby">      if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="73" data-linenumber="628">
            <span class="hits">73</span>
            

            

            <code class="ruby">        next_url = url + &quot;&amp;cursor=#{next_cursor}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="629">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="630">
            <span class="hits">38</span>
            

            

            <code class="ruby">        next_url = url + &quot;?cursor=#{next_cursor}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="631">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="111" data-linenumber="632">
            <span class="hits">111</span>
            

            

            <code class="ruby">      add_link_as_sibling(doc, last_link, next_url, &#39;application/atom+xml&#39;, &#39;next&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="633">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="634">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="635">
            
            

            

            <code class="ruby">    # Insert previous link</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="636">
            <span class="hits">263</span>
            

            

            <code class="ruby">    if need_prev_cursor?(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="637">
            <span class="hits">16</span>
            

            

            <code class="ruby">      previous_cursor = params[:cursor].to_i - 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="638">
            <span class="hits">16</span>
            

            

            <code class="ruby">      if url.include?(&#39;?&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="639">
            <span class="hits">16</span>
            

            

            <code class="ruby">        previous_url = url + &quot;&amp;cursor=#{previous_cursor}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="640">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="641">
            
            

            

            <code class="ruby">        previous_url = url + &quot;?cursor=#{previous_cursor}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="642">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="643">
            <span class="hits">16</span>
            

            

            <code class="ruby">      add_link_as_sibling(doc, last_link, previous_url, &#39;application/atom+xml&#39;, &#39;previous&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="644">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="645">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="646">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="647">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def generate_mbr(doc, element)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="648">
            <span class="hits">14</span>
            

            

            <code class="ruby">    geometry = element.content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="649">
            <span class="hits">14</span>
            

            

            <code class="ruby">    mbr = Nokogiri::XML::Node.new &quot;georss:box&quot;, doc</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="650">
            <span class="hits">14</span>
            

            

            <code class="ruby">    bbox = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="651">
            <span class="hits">14</span>
            

            

            <code class="ruby">    points = string_to_points geometry</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="652">
            <span class="hits">14</span>
            

            

            <code class="ruby">    if element.name == &#39;georss:polygon&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="653">
            <span class="hits">10</span>
            

            

            <code class="ruby">      bbox = GeoRuby::SimpleFeatures::Polygon.from_points([points]).bounding_box</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="654">
            <span class="hits">4</span>
            

            

            <code class="ruby">    elsif element.name == &#39;georss:line&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="655">
            <span class="hits">2</span>
            

            

            <code class="ruby">      bbox = GeoRuby::SimpleFeatures::LineString.from_points(points).bounding_box</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="656">
            <span class="hits">2</span>
            

            

            <code class="ruby">    elsif element.name == &#39;georss:point&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="657">
            <span class="hits">2</span>
            

            

            <code class="ruby">      bbox = [points[0], points[0]]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="658">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="659">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="660">
            <span class="hits">14</span>
            

            

            <code class="ruby">    south = bbox[0].y</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="661">
            <span class="hits">14</span>
            

            

            <code class="ruby">    east = bbox[1].x</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="662">
            <span class="hits">14</span>
            

            

            <code class="ruby">    north = bbox[1].y</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="663">
            <span class="hits">14</span>
            

            

            <code class="ruby">    west = bbox[0].x</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="664">
            <span class="hits">14</span>
            

            

            <code class="ruby">    mbr.content = &quot;#{south} #{west} #{north} #{east}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="665">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="666">
            <span class="hits">14</span>
            

            

            <code class="ruby">    mbr</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="667">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="668">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="669">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def string_to_points str</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="670">
            
            

            

            <code class="ruby">    # lat, lng</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="671">
            <span class="hits">14</span>
            

            

            <code class="ruby">    points = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="672">
            <span class="hits">14</span>
            

            

            <code class="ruby">    point_array = str.split(&#39; &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="673">
            <span class="hits">14</span>
            

            

            <code class="ruby">    point_array.each_index do |x|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="116" data-linenumber="674">
            <span class="hits">116</span>
            

            

            <code class="ruby">      points &lt;&lt; GeoRuby::SimpleFeatures::Point.from_x_y(point_array[x+1].to_f, point_array[x].to_f) if x.even?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="675">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="676">
            <span class="hits">14</span>
            

            

            <code class="ruby">    points</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="677">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="678">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="679">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def fix_geo_href(response)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="268" data-linenumber="680">
            <span class="hits">268</span>
            

            

            <code class="ruby">    doc_as_string = response.to_str</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="268" data-linenumber="681">
            <span class="hits">268</span>
            

            

            <code class="ruby">    doc_as_string.gsub!(&#39;http://www.georss.org/georss/10&#39;, &#39;http://www.georss.org/georss&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="268" data-linenumber="682">
            <span class="hits">268</span>
            

            

            <code class="ruby">    doc_as_string</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="683">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="684">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="685">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def need_prev_cursor? (params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="270" data-linenumber="686">
            <span class="hits">270</span>
            

            

            <code class="ruby">    params[:cursor].to_i &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="687">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="688">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="689">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def need_prev_offset? (params, hits)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="690">
            
            

            

            <code class="ruby">    # offset always starts at the desired offset, pagination always starts at 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="691">
            
            

            

            <code class="ruby">    # consider that we can decrease the offset by the page_size as long as we are within the result bounds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="692">
            <span class="hits">27</span>
            

            

            <code class="ruby">    offset = params[:offset].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="693">
            <span class="hits">27</span>
            

            

            <code class="ruby">    page_size = params[:numberOfResults].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="694">
            <span class="hits">27</span>
            

            

            <code class="ruby">    offset -  page_size &gt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="695">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="696">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="697">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def need_next_cursor? (params, hits)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="270" data-linenumber="698">
            <span class="hits">270</span>
            

            

            <code class="ruby">    cursor = params[:cursor].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="270" data-linenumber="699">
            <span class="hits">270</span>
            

            

            <code class="ruby">    cursor = cursor - 1 unless cursor == 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="270" data-linenumber="700">
            <span class="hits">270</span>
            

            

            <code class="ruby">    hits &gt; (cursor*params[:numberOfResults].to_i + params[:numberOfResults].to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="701">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="702">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="703">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def need_next_offset? (params, hits)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="704">
            <span class="hits">27</span>
            

            

            <code class="ruby">    offset = params[:offset].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="705">
            
            

            

            <code class="ruby">    #offset =  offset -1 unless offset = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="706">
            <span class="hits">27</span>
            

            

            <code class="ruby">    page_size = params[:numberOfResults].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="707">
            <span class="hits">27</span>
            

            

            <code class="ruby">    hits - offset &gt;= page_size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="708">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="709">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="710">
            <span class="hits">2</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="711">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="712">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def remove_url_query_parameter(params, url, param_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="713">
            <span class="hits">287</span>
            

            

            <code class="ruby">    url.gsub!(&quot;#{param_name}=\&amp;&quot;, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="714">
            <span class="hits">287</span>
            

            

            <code class="ruby">    url.gsub!(&quot;#{param_name}=#{params[param_name.to_sym]}\&amp;&quot;, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="715">
            <span class="hits">287</span>
            

            

            <code class="ruby">    url.gsub!(&quot;#{param_name}=#{params[param_name.to_sym]}&quot;, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="716">
            <span class="hits">287</span>
            

            

            <code class="ruby">    url.gsub!(&quot;#{param_name}=&quot;, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="287" data-linenumber="717">
            <span class="hits">287</span>
            

            

            <code class="ruby">    url.chop! if url.end_with?(&#39;&amp;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="718">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="719">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2243f432da5b0f6d45c9593aec23957762ab70cb">
  <div class="header">
    <h3>app/models/token.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>19</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>19</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1">
            
            

            

            <code class="ruby">class Token</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            
            

            

            <code class="ruby">  def self.get(client_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">    # For our metrics purposes the client id we send to echo is the user supplied client id + open search tag + OPS/PT/TB</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">    composite_client_id = &quot;#{client_id}-opensearch-#{ENV[&#39;mode&#39;]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            
            

            

            <code class="ruby">    payload = &quot;&lt;token&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            
            

            

            <code class="ruby">          &lt;username&gt;guest&lt;/username&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">          &lt;password&gt;guest@echo.nasa.gov&lt;/password&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">          &lt;client_id&gt;#{composite_client_id}&lt;/client_id&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">          &lt;user_ip_address&gt;0.0.0.0&lt;/user_ip_address&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">        &lt;/token&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    response = RestClient::Request.execute :method =&gt; :post, :url =&gt; &quot;#{ENV[&#39;echo_rest_endpoint&#39;]}/tokens&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">                                           :payload =&gt; payload, :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">                                           :headers =&gt; {:content_type =&gt; &#39;application/xml&#39;}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    token_id = Nokogiri::XML(response.to_str).xpath(&#39;token/id&#39;).first.to_str</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    return token_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">  def self.delete(token_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">    RestClient.delete &quot;https://api.echo.nasa.gov/echo-rest/tokens/#{token_id}&quot;, {:echo_token =&gt; token_id}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="baa50acb1e1b70ab20213e687457df3140265ec2">
  <div class="header">
    <h3>app/services/connection_verifier.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"># This was created for NCRs 11012624 and 11012632.  We found a concurrency bug in Rails&#39; ActiveRecord ConnectionPool class.  The problem</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># seems to be causing connections to be shared across threads sporadically.  We added this module as a stop gap to help verify that we have not</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby"># received a bad or in use connection.  The verify method fails if a connection is in a transaction that already started.</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">module ConnectionVerifier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            
            

            

            <code class="ruby">  MESSAGE = &quot;Detected connection with existing transaction open&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  def self.verify_not_in_transaction</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    conn = ActiveRecord::Base.connection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    raw_conn = conn.raw_connection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">    if raw_conn.auto_commit == false || conn.open_transactions != 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">      message = &quot;#{MESSAGE} auto_commit is #{raw_conn.auto_commit}, open transactions is #{conn.open_transactions}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">      Rails.logger.error(message)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">      raise RestErrors::ServiceUnavailable.new(message)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2f3522218aa2242a6f05e60574ac63ff72f0a04a">
  <div class="header">
    <h3>app/services/eosdis_tagger.rb</h3>
    <h4>
      <span class="green">
  90.72%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>97</b> relevant lines.
      <span class="green"><b>88</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># Because CMR tagging is static, only collections for EOSDIS PROVIDERS that exist when the tagging association is executed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"># are tagged.  That means that if new EOSDIS providers and new providers collections are added, they must be tagged</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby"># separately.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># This class provides functionality to tag all of EOSDIS providers collections.  It wil run as part of a scheduled task.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            <span class="hits">1</span>
            

            

            <code class="ruby">class EosdisTagger</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">  # array of EOSDIS providers identifiers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby">  # this array must be updated when new EOSDIS providers are added, tricky proposition</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  attr_accessor :EOSDIS_PROVIDERS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  EOSDIS_PROVIDERS = Rails.configuration.eosdis_providers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">  attr_accessor :token, :catalog_rest_endpoint, :cmr_base_endpoint, :tag</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">    # token used for tagging, grants tagging permissions to caller</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @token = &quot;#{ENV[&#39;CMR_ECHO_SYSTEM_TOKEN&#39;]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @catalog_rest_endpoint = &quot;#{ENV[&#39;public_catalog_rest_endpoint&#39;]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @cmr_base_endpoint = @catalog_rest_endpoint.gsub(&#39;search/&#39;, &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @ingest_providers_list_endpoint = &quot;#{@cmr_base_endpoint}ingest/providers&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">    # tag to process</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @tag = Rails.configuration.eosdis_tag</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @all_providers = Hash.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @tagged_providers = Hash.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @tagging_errors = Hash.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">  # this is an alternate tagging mechanism that we can use if the single post is difficult to debug</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def execute_scheduled_task</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;EOSDISTagger START run of scheduled EOSDIS tagging task: #{Time.now}, catalog_rest_endpoint: #{@catalog_rest_endpoint}, cmr_base_endpoint: #{@cmr_base_endpoint}, ingest_providers_list_endpoint: #{@ingest_providers_list_endpoint}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            <span class="hits">1</span>
            

            

            <code class="ruby">    time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">      verify_tag_presence</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            <span class="hits">1</span>
            

            

            <code class="ruby">      populate_providers_hash</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">      EOSDIS_PROVIDERS.each do |provider|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="35">
            <span class="hits">22</span>
            

            

            <code class="ruby">        tag_provider_collections(provider)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            <span class="hits">1</span>
            

            

            <code class="ruby">      log_tagging_metrics</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;EOSDIS collection tagging with ONE post request per provider took #{(time.to_f * 1000).round(0)} ms&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            <span class="hits">1</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;EOSDISTagger END run of scheduled EOSDIS tagging task: #{Time.now}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">  # this is the current tagging mechanism being used in the rufus scheduled task</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def execute_scheduled_task_single_post</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            <span class="hits">1</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;EOSDISTagger START run of scheduled EOSDIS tagging task single POST request: #{Time.now}, catalog_rest_endpoint: #{@catalog_rest_endpoint}, cmr_base_endpoint: #{@cmr_base_endpoint}, ingest_providers_list_endpoint: #{@ingest_providers_list_endpoint}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            <span class="hits">1</span>
            

            

            <code class="ruby">    time = Benchmark.realtime do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            <span class="hits">1</span>
            

            

            <code class="ruby">      verify_tag_presence</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">      populate_providers_hash</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            <span class="hits">1</span>
            

            

            <code class="ruby">      tag_provider_collections_single_post</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            <span class="hits">1</span>
            

            

            <code class="ruby">      log_tagging_metrics</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            <span class="hits">1</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;EOSDIS collection tagging scheduled task with ONE post request took #{(time.to_f * 1000).round(0)} ms&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            <span class="hits">1</span>
            

            

            <code class="ruby">    Rails.logger.info &quot;EOSDISTagger END run of scheduled EOSDIS tagging task single POST request: #{Time.now}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def verify_tag_presence</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">    # verify that tag exists</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="58">
            <span class="hits">2</span>
            

            

            <code class="ruby">    response = RestClient::Request.execute :method =&gt; :get, :url =&gt; &quot;#{@catalog_rest_endpoint}tags/#{@tag}&quot;, :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="59">
            <span class="hits">2</span>
            

            

            <code class="ruby">    if (response.code != 200)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            
            

            

            <code class="ruby">      Rails.logger.info(&quot;ERROR #{response.code} retrieving tag: #{@tag}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby">      # terminate task if the tag is not present</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">      exit(status=256)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="64">
            <span class="hits">2</span>
            

            

            <code class="ruby">      Rails.logger.info(&quot;LOCATED TAG: #{@tag}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">  # this is an extra check that help with unexpected tagging results due to miss-spelling the provider id in the array above</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def populate_providers_hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            
            

            

            <code class="ruby">    # GET A LIST OF ALL PROVIDERS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="71">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Rails.logger.info(&quot;Retrieving providers list from #{@ingest_providers_list_endpoint}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="72">
            <span class="hits">2</span>
            

            

            <code class="ruby">    response = RestClient::Request.execute :method =&gt; :get, :url =&gt; &quot;#{@ingest_providers_list_endpoint}&quot;, :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="73">
            <span class="hits">2</span>
            

            

            <code class="ruby">    if (response.code != 200)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">      Rails.logger.info(&quot;ERROR #{response.code} retrieving providers list&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">      # terminate task if we cannot validate the providers names</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">      exit(status=256)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="78">
            <span class="hits">2</span>
            

            

            <code class="ruby">      list_of_providers_hashes = JSON.parse!(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="79">
            <span class="hits">2</span>
            

            

            <code class="ruby">      list_of_providers_hashes.each do |hash|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="80">
            <span class="hits">68</span>
            

            

            <code class="ruby">        provider_id = hash[&#39;provider-id&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="81">
            <span class="hits">68</span>
            

            

            <code class="ruby">        @all_providers[provider_id] = &#39;Y&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="83">
            <span class="hits">2</span>
            

            

            <code class="ruby">      Rails.logger.info(&quot;RETRIEVED A LIST OF ALL PROVIDERS, SIZE: #{list_of_providers_hashes.size}, LOOKUP SIZE: #{@all_providers.size}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def tag_provider_collections(provider)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="88">
            <span class="hits">22</span>
            

            

            <code class="ruby">    if !provider.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="89">
            <span class="hits">22</span>
            

            

            <code class="ruby">      provider = provider.strip</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="90">
            <span class="hits">22</span>
            

            

            <code class="ruby">      Rails.logger.info(&quot;Processing provider: #{provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">      #ensure that provider is present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="92">
            <span class="hits">22</span>
            

            

            <code class="ruby">      if (@all_providers[provider] != nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="93">
            <span class="hits">22</span>
            

            

            <code class="ruby">        Rails.logger.info(&quot;LOCATED PROVIDER: #{provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">        # COLLECTIONS ARE BEING TAGGED so let&#39;s check if there are collections for each provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby">        # help with debugging of timing issues since the tagging occurs at midnight and perhaps the collections expected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            
            

            

            <code class="ruby">        # in the results set are tagged after that</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="97">
            <span class="hits">22</span>
            

            

            <code class="ruby">        response = RestClient::Request.execute :method =&gt; :get, :url =&gt; &quot;#{@catalog_rest_endpoint}collections&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            
            

            

            <code class="ruby">                                               headers: {params: {provider: provider}},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">                                               :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="100">
            <span class="hits">22</span>
            

            

            <code class="ruby">        hits = response.headers[:cmr_hits].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="101">
            <span class="hits">22</span>
            

            

            <code class="ruby">        if hits &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="102">
            <span class="hits">20</span>
            

            

            <code class="ruby">          Rails.logger.info(&quot;PROVIDER #{provider} HAS #{hits} COLLECTIONS&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="103">
            <span class="hits">20</span>
            

            

            <code class="ruby">          post_body = &#39;{&quot;condition&quot;: {&quot;provider&quot;: &quot;&#39; + provider + &#39;&quot;}}&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="104">
            <span class="hits">20</span>
            

            

            <code class="ruby">          response = RestClient::Request.execute :method =&gt; :post, :url =&gt; &quot;#{@catalog_rest_endpoint}tags/#{@tag}/associations/by_query&quot;, :payload =&gt; post_body,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">                                                 :headers =&gt; {&#39;Echo-token&#39; =&gt; @token, &#39;Content-Type&#39; =&gt; &#39;application/json&#39;},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            
            

            

            <code class="ruby">                                                 :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="107">
            <span class="hits">20</span>
            

            

            <code class="ruby">          if (response.code != 200)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">            Rails.logger.info(&quot;COULD NOT TAG PROVIDER: #{provider}, ERROR: &quot; + response.code)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            
            

            

            <code class="ruby">            @tagging_errors[provider] = response_code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="111">
            <span class="hits">20</span>
            

            

            <code class="ruby">            Rails.logger.info(&quot;SUCCESSFULY TAGGED PROVIDER: #{provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="112">
            <span class="hits">20</span>
            

            

            <code class="ruby">            @tagged_providers[provider] = &#39;tagged&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">        Rails.logger.info(&quot;COULD NOT LOCATE PROVIDER: #{provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  # added to prove that the debugging is much more complicated with a single request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def tag_provider_collections_single_post</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="123">
            <span class="hits">1</span>
            

            

            <code class="ruby">    post_body = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            <span class="hits">1</span>
            

            

            <code class="ruby">    post_body_providers = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            <span class="hits">1</span>
            

            

            <code class="ruby">    EOSDIS_PROVIDERS.each do |provider|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="126">
            <span class="hits">22</span>
            

            

            <code class="ruby">      if !provider.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="127">
            <span class="hits">22</span>
            

            

            <code class="ruby">        provider = provider.strip</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="128">
            <span class="hits">22</span>
            

            

            <code class="ruby">        Rails.logger.info(&quot;Processing provider: #{provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">        #ensure that provider is present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="130">
            <span class="hits">22</span>
            

            

            <code class="ruby">        if (@all_providers[provider] != nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="131">
            <span class="hits">22</span>
            

            

            <code class="ruby">          Rails.logger.info(&quot;LOCATED PROVIDER: #{provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">          # COLLECTIONS ARE BEING TAGGED so let&#39;s check if there are collections for each provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">          # help with debugging of timing issues since the tagging occurs at midnight and perhaps the collections expected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            
            

            

            <code class="ruby">          # in the results set are tagged after that</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="135">
            <span class="hits">22</span>
            

            

            <code class="ruby">          response = RestClient::Request.execute :method =&gt; :get, :url =&gt; &quot;#{@catalog_rest_endpoint}collections&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">                                                 headers: {params: {provider: provider}},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby">                                                 :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="138">
            <span class="hits">22</span>
            

            

            <code class="ruby">          hits = response.headers[:cmr_hits].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="139">
            <span class="hits">22</span>
            

            

            <code class="ruby">          if hits &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="140">
            <span class="hits">20</span>
            

            

            <code class="ruby">            Rails.logger.info(&quot;PROVIDER #{provider} HAS #{hits} COLLECTIONS&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="141">
            <span class="hits">20</span>
            

            

            <code class="ruby">            post_body_providers = post_body_providers + &#39;{&quot;provider&quot;: &quot;&#39; + provider + &#39;&quot;},&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            
            

            

            <code class="ruby">          Rails.logger.info(&quot;COULD NOT LOCATE PROVIDER: #{provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="148">
            <span class="hits">1</span>
            

            

            <code class="ruby">    if (!post_body_providers.blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="149">
            <span class="hits">1</span>
            

            

            <code class="ruby">      post_body_providers = post_body_providers.chomp(&#39;,&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="150">
            <span class="hits">1</span>
            

            

            <code class="ruby">      post_body = &#39;{</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">            &quot;condition&quot;: {&quot;or&quot; : [&#39; + post_body_providers +</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">          &#39;]}}&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="153">
            <span class="hits">1</span>
            

            

            <code class="ruby">      Rails.logger.info(&quot;POST request body: #{post_body}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            
            

            

            <code class="ruby">      # one request takes much longer so we must increase the read_timeout (seconds)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="155">
            <span class="hits">1</span>
            

            

            <code class="ruby">      response = RestClient::Request.execute :method =&gt; :post, :url =&gt; &quot;#{@catalog_rest_endpoint}tags/#{@tag}/associations/by_query&quot;, :payload =&gt; post_body,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">                                             :headers =&gt; {&#39;Echo-token&#39; =&gt; @token, &#39;Content-Type&#39; =&gt; &#39;application/json&#39;},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">                                             :verify_ssl =&gt; OpenSSL::SSL::VERIFY_NONE, :timeout =&gt; 240</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="158">
            <span class="hits">1</span>
            

            

            <code class="ruby">      if (response.code != 200)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">        Rails.logger.info(&quot;COULD NOT TAG PROVIDERS, ERROR: #{response.code}, BODY: #{response.body} &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            <span class="hits">1</span>
            

            

            <code class="ruby">        Rails.logger.info(&quot;SUCCESSFULY TAGGED ALL PROVIDERS&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">  # summary of tagging run</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="167">
            <span class="hits">1</span>
            

            

            <code class="ruby">  def log_tagging_metrics</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="168">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Rails.logger.info(&quot;TOTAL INPUT PROVIDERS: #{EOSDIS_PROVIDERS.size}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="169">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Rails.logger.info(&quot;INPUT PROVIDERS: #{EOSDIS_PROVIDERS}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="171">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Rails.logger.info(&quot;TOTAL TAGGED PROVIDERS (providers with associated collections): #{@tagged_providers.size}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="172">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Rails.logger.info(&quot;TAGGED PROVIDERS (providers with associated collections): #{@tagged_providers.keys}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="174">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Rails.logger.info(&quot;TOTAL ERRORS TAGGING PROVIDERS: #{@tagging_errors.size}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="175">
            <span class="hits">2</span>
            

            

            <code class="ruby">    Rails.logger.info(&quot;PROVIDERS THAT FAILED TAGGING: #{@tagging_errors}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cb8a13b46016e1e68d99562d31c9bc64bbdf1091">
  <div class="header">
    <h3>app/services/place_name_to_point.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">require &#39;json&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            <span class="hits">2</span>
            

            

            <code class="ruby">class PlaceNameToPoint</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  URL = &quot;http://api.geonames.org/searchJSON?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="5">
            <span class="hits">2</span>
            

            

            <code class="ruby">  FIXED_PARAMETERS = &quot;&amp;username=echo_reverb&amp;maxRows=1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.exists? place_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="8">
            <span class="hits">14</span>
            

            

            <code class="ruby">    find(place_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.find(place_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="12">
            <span class="hits">19</span>
            

            

            <code class="ruby">    url = &quot;#{URL}q=#{URI.encode(place_name)}#{FIXED_PARAMETERS}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="13">
            <span class="hits">19</span>
            

            

            <code class="ruby">    resp = Net::HTTP.get_response(URI.parse(url))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="14">
            <span class="hits">19</span>
            

            

            <code class="ruby">    data = resp.body</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="16">
            <span class="hits">19</span>
            

            

            <code class="ruby">    result = JSON.parse(data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="17">
            <span class="hits">19</span>
            

            

            <code class="ruby">    location = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="18">
            <span class="hits">19</span>
            

            

            <code class="ruby">    location = result[&#39;geonames&#39;].first if result and result[&#39;geonames&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="20">
            <span class="hits">19</span>
            

            

            <code class="ruby">    location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="23">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.add_cmr_param(params, place_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="24">
            <span class="hits">5</span>
            

            

            <code class="ruby">    location = find(place_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="25">
            <span class="hits">5</span>
            

            

            <code class="ruby">    params[:point] = &quot;#{location[&#39;lng&#39;]},#{location[&#39;lat&#39;]}&quot; if location</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="26">
            <span class="hits">5</span>
            

            

            <code class="ruby">    params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2c445d8e7fefeee2cf6a88395a03bce297fd0176">
  <div class="header">
    <h3>app/services/well_formed_text.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="1">
            <span class="hits">2</span>
            

            

            <code class="ruby">require &#39;rgeo&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            <span class="hits">2</span>
            

            

            <code class="ruby">class WellFormedText</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.add_cmr_param (params, well_known_text)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="5">
            <span class="hits">28</span>
            

            

            <code class="ruby">    factory = RGeo::Cartesian.factory</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="7">
            <span class="hits">28</span>
            

            

            <code class="ruby">    geometry = factory.parse_wkt(well_known_text)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="9">
            <span class="hits">28</span>
            

            

            <code class="ruby">    params[:point] = &quot;#{geometry.x},#{geometry.y}&quot; if ::RGeo::Feature::Point.check_type(geometry)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="10">
            <span class="hits">28</span>
            

            

            <code class="ruby">    if ::RGeo::Feature::LineString.check_type(geometry)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="11">
            <span class="hits">9</span>
            

            

            <code class="ruby">      params[:line] = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="12">
            <span class="hits">9</span>
            

            

            <code class="ruby">      geometry.points.each do |point|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="13">
            <span class="hits">19</span>
            

            

            <code class="ruby">        params[:line] += &quot;#{point.x},#{point.y},&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="15">
            <span class="hits">9</span>
            

            

            <code class="ruby">      params[:line].chop!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="17">
            <span class="hits">28</span>
            

            

            <code class="ruby">    if ::RGeo::Feature::Polygon.check_type(geometry)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="18">
            <span class="hits">10</span>
            

            

            <code class="ruby">      params[:polygon] = &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            <span class="hits">10</span>
            

            

            <code class="ruby">      geometry.exterior_ring.points.reverse_each do |point|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="20">
            <span class="hits">45</span>
            

            

            <code class="ruby">        params[:polygon] += &quot;#{point.x},#{point.y},&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="22">
            <span class="hits">10</span>
            

            

            <code class="ruby">      params[:polygon].chop!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="24">
            <span class="hits">28</span>
            

            

            <code class="ruby">    params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="27">
            <span class="hits">2</span>
            

            

            <code class="ruby">  def self.to_wkt(param)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
